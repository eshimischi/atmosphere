import{d as Q,q as b,T as X,E as q,r as z,o as v,f as V,a as s,w as o,b as t,t as h,c as S,u as e,i as _,G as ee,g as x,n as F,s as L,O as j,B as P,C as E,H as te}from"./app-114b751b.js";import{Z as N,B as se,L as ae}from"./atmosphere-ui-b819c890.js";import{N as R,f as oe,b as ne,c as le,d as re}from"./isMobile-e3872359.js";import{_ as ie}from"./Modal-c2871cdd.js";import{_ as de}from"./AppLayout.vue_vue_type_script_setup_true_lang-c7e24bdb.js";import{_ as K}from"./BudgetDetailForm-994fb96a.js";import{a as U,u as ue,_ as ce,F as me}from"./useServerSearch-55d027ef.js";import{f as Z,s as W}from"./formatMoney-75af80f0.js";import{_ as pe}from"./LogerButton-7d66d0a8.js";import{_ as ge}from"./BudgetProgress-06c39c7c.js";import{_ as ve}from"./ExpenseIncome.vue_vue_type_script_setup_true_lang-571a0552.js";import{P as fe,_ as ye}from"./BudgetCategories-b9369f37.js";import{I as Y}from"./IconClose-c46c1987.js";import{f as H}from"./index-2052210e.js";import{u as be}from"./budgetTotals-564808f0.js";import"./exact-math.node-ab123f44.js";import{_ as _e}from"./StatusButtons-c1cd28d1.js";/* empty css                                              */import"./useFirebase-fe12e715.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./AppIcon-f342d706.js";/* empty css                                                */import"./LogerInput-8ca4e824.js";import"./Dropdown-839d2ecf.js";import"./NumberHider-49c0aef0.js";import"./vue-draggable-next.esm-bundler-3a2dc928.js";import"./constants-cb26b0c1.js";import"./WidgetCard-f1e3a88f.js";import"./SectionTitle-20b8f2ca.js";import"./SectionNav-dd96bdd5.js";const he={class:"text-lg font-bold"},xe={class:"w-72 md:w-96"},we={class:"flex justify-between text-sm group md:text-base"},$e={class:""},Ce={key:0,class:"text-success group-hover:text-white"},Se={class:"flex items-center justify-end space-x-2"},ke={class:"text-center"},Be={class:"grid grid-cols-2 overflow-hidden divide-x-2"},De=Q({__name:"BalanceAssign",props:{value:{type:Number},formatter:{type:Function,default:Z},category:{type:Object,required:!0},toAssign:{type:Object,required:!0}},setup(d){const u=d,f={good:"bg-success/80 text-white",danger:"bg-primary text-white",needs:"bg-warning",overspend:"bg-warning",default:"bg-base-lvl-3"},n={overspent:{name:"overspent",description:"You assigned more than you have"},available:{name:"available",description:"To budget"},empty:{name:"empty",description:"All money assigned"}},p=b(()=>u.value>0?n.available.name:u.value<0?n.overspent.name:n.empty.name),A=b(()=>p.value==n.overspent.name),O=b(()=>n[p.value].description),c=b(()=>{let l=f.default;return p.value===n.available.name?l=f.good:p.value===n.overspent.name&&(l=f.danger),[l]}),$=X({amount:Math.abs(u.value),source_category_id:null,destination_category_id:null}),y=q("pageState",{dates:{endDate:new Date}}),T=()=>{var l;if(Number(u.value)!==0){const m=oe(W((l=y==null?void 0:y.dates)==null?void 0:l.endDate),"yyyy-MM-dd");debugger;const r=p.value==n.available?"source_category_id":"destination_category_id";$.transform(B=>{var D;return{...B,budgeted:Math.abs(u.value),[r]:u.category.id,source_category_id:(D=B.source_category_id)==null?void 0:D.value,type:"movement"}}).post(`/budgets/${u.category.id}/months/${m}`,{onSuccess(){j.reload({preserveScroll:!0})}})}},k=q("categories",z({data:[]})),w=b(()=>{var l;return console.log(k.value.data),(l=k.value.data)==null?void 0:l.map(m=>({value:m.id,key:m.id,label:m.name,type:"group",children:m.subCategories.map(r=>({value:r.id,label:r.name,available:r.available}))}))}),i=z(!1),G=()=>{$.reset(),i.value=!1},I=()=>{i.value=!i.value};return(l,m)=>(v(),V("section",{class:F(["overflow-hidden border divide-y-2 rounded-md cursor-pointer text-body-1",f.default]),onClick:I},[s(e(R),null,{trigger:o(()=>[t("article",{class:F(["flex flex-col items-center justify-center py-4 mx-auto",c.value])},[t("h4",he,h(d.formatter(d.value)),1),t("small",null,h(O.value),1),A.value?(v(),S(e(R),{key:0,trigger:"manual",placement:"bottom","onUpdate:show":l.handleUpdateShow,show:i.value},{trigger:o(()=>[s(e(N),{class:"text-white rounded-md bg-black/30"},{default:o(()=>[_(" Fix this ")]),_:1})]),default:o(()=>[t("div",xe,[s(e(se),{label:"From"},{default:o(()=>[s(e(ee),{modelValue:e($).source_category_id,"onUpdate:modelValue":m[0]||(m[0]=r=>e($).source_category_id=r),options:w.value,"group-values":"children","group-label":"label",placeholder:"Type to search","track-by":"value",label:"label","select-label":""},{option:o(({option:r})=>[t("div",we,[t("span",$e,h(r.label||r.$groupLabel),1),r.available?(v(),V("span",Ce,h(e(Z)(r.available)),1)):x("",!0)])]),_:1},8,["modelValue","options"])]),_:1}),t("div",Se,[s(e(N),{class:"text-body-1",onClick:G},{default:o(()=>[_("Cancel")]),_:1}),s(e(N),{class:"text-white rounded-md bg-success",onClick:m[1]||(m[1]=r=>T())},{default:o(()=>[_(" Save")]),_:1})])])]),_:1},8,["onUpdate:show","show"])):x("",!0)],2)]),default:o(()=>[t("section",ke,[t("p",null,[_("Inflow: Ready to assign transactions in Month: "),s(U,{value:d.category.activity},null,8,["value"])]),t("p",null,[_("Assigned in month: "),s(U,{value:d.toAssign.budgeted},null,8,["value"])])])]),_:1}),t("article",Be,[t("section",null,[L(l.$slots,"activity")]),t("section",null,[L(l.$slots,"target")])])],2))}}),Me={key:0,class:"border border-primary rounded-md bg-white py-4 px-8"},Ae={class:"flex justify-between"},Oe={class:"text-primary font-bold text-lg"},Te={class:"text-body-1/80"},je={__name:"MessageBox",props:{storageKey:{type:String},title:{type:String},content:{type:String},isClosable:{type:Boolean,default:!0}},setup(d){const u=d,f=ne(u.title||u.storageKey,!0);return(n,p)=>e(f)?(v(),V("article",Me,[t("header",Ae,[t("h4",Oe,h(d.title),1),d.isClosable?(v(),V("button",{key:0,onClick:p[0]||(p[0]=A=>f.value=!1)},[s(Y)])):x("",!0)]),t("p",Te,h(d.content),1)])):x("",!0)}};const Ne={class:"flex items-center space-x-2"},Ve={class:"relative"},Fe={class:"text-white text-sm rounded-full group-hover:bg-white/20 p-0.5"},Ue={class:"flex flex-col items-center justify-center w-full py-2"},Ge={class:"font-bold text-secondary"},Ie=t("p",{class:"font-bold text-body-1/80"},"Activity",-1),qe={class:"font-bold"},ze={class:"text-secondary"},Le=t("p",{class:"font-bold text-body-1/80"},"Monthly Goals Progress",-1),Pe={class:"mx-auto mt-8 rounded-lg text-body bg-base max-w-7xl"},Ee={class:"w-full mt-4 space-y-4"},Re={class:"space-y-4"},Ke={class:"mt-4 space-y-4"},$t={__name:"Budget",props:{budgets:{type:Array,required:!0},accounts:{type:Array,default(){return[]}},categories:{type:Array,required:!0},serverSearchOptions:{type:Object,default:()=>({})}},setup(d){const u=d,{serverSearchOptions:f}=P(u),{state:n,executeSearchWithDelay:p}=ue(f,{manual:!0});E("pageState",n);const A=b(()=>`${H(n.dates.startDate,"MMMM yyyy")}`),{budgets:O}=P(u),{readyToAssign:c,filterGroups:$,filters:y,visibleFilters:T,toggleFilter:k,setSelectedBudget:w,selectedBudget:i}=be(),G=b(()=>i.value?"small":"large"),{isSmaller:I}=le(re),l=I("md"),m={funded:{label:"funded"},underFunded:{label:"Not funded"}},r=b(()=>Object.keys(y.value).find(C=>y.value[C]));E("categories",O);const B=C=>{j.delete(route("budgets.destroy",C),{onSuccess:()=>{j.reload(["budgets"])}})},D=()=>{},J=()=>{n.dates.startDate=W(new Date),p()};return(C,a)=>(v(),S(de,{title:A.value,onBack:a[10]||(a[10]=g=>e(j).visit(C.route("finance"))),"show-back-button":!0},{header:o(()=>[s(ce,null,{actions:o(()=>{var g;return[t("div",Ne,[e(T).overspent?(v(),S(e(N),{key:0,onClick:a[0]||(a[0]=M=>e(k)("overspent")),class:F(["flex items-center justify-between space-x-2 rounded-md min-w-fit group",[e(y).overspent?"bg-primary text-white":"text-primary"]])},{default:o(()=>[t("span",Ve,[_(h(e($).overSpent.length)+" Overspent categories ",1),e(y).overspent?x("",!0):(v(),S(fe,{key:0}))]),t("div",Fe,[s(Y)])]),_:1},8,["class"])):x("",!0),s(_e,{modelValue:r.value,statuses:m,onChange:e(k)},null,8,["modelValue","onChange"]),s(pe,{variant:"inverse",onClick:J},{default:o(()=>[_(" Today ")]),_:1}),(g=e(n).dates)!=null&&g.startDate?(v(),S(e(ae),{key:1,class:"w-full h-12 border-none bg-base-lvl-1 text-body",startDate:e(n).dates.startDate,"onUpdate:startDate":a[1]||(a[1]=M=>e(n).dates.startDate=M),endDate:e(n).dates.endDate,"onUpdate:endDate":a[2]||(a[2]=M=>e(n).dates.endDate=M),onChange:a[3]||(a[3]=M=>e(p)()),controlsClass:"bg-transparent text-body hover:bg-base-lvl-1","next-mode":"month"},{default:o(()=>[_(h(e(H)(e(n).dates.startDate,"MMMM")),1)]),_:1},8,["startDate","endDate"])):x("",!0)])]}),_:1})]),default:o(()=>[s(me,{accounts:d.accounts,"panel-size":G.value},{panel:o(()=>[t("div",Ke,[e(i)&&!e(l)?(v(),S(K,{key:0,class:"mt-5",full:"",category:e(i),item:e(i).budget,onSaved:D,onDeleted:B,onCancel:a[4]||(a[4]=g=>e(w)()),onClose:a[5]||(a[5]=g=>e(w)())},null,8,["category","item"])):x("",!0),s(ve,{value:e(c).inflow+e(c).activity,"footer-stats":[{label:"Income",value:e(c).inflow,class:"text-success"},{label:"Expense",value:e(c).activity,class:"text-error"}]},null,8,["value","footer-stats"])])]),default:o(()=>[s(je,{title:"This is your budget.",content:"Create new category groups and categories and organize them to suit your needs"}),s(De,{class:F(["mt-5 rounded-t-md",[C.cardShadow,!e(T).overspent&&"rounded-b-md"]]),value:e(c).balance,category:e(c).toAssign,"to-assign":e(c)},{activity:o(()=>[t("section",Ue,[t("h4",Ge,[s(U,{value:e(c).activity},null,8,["value"])]),Ie])]),target:o(()=>[s(ge,{class:"w-full text-center h-14",goal:e(c).monthlyGoals.target,current:e(c).monthlyGoals.balance,"progress-class":["bg-secondary/10","bg-secondary/5"]},{default:o(()=>[t("section",qe,[t("h4",ze,[s(U,{value:e(c).monthlyGoals.balance},null,8,["value"])]),Le])]),_:1},8,["goal","current"])]),_:1},8,["class","value","category","to-assign"]),t("section",Pe,[t("article",Ee,[t("section",Re,[s(ye,{budgets:e(O)},null,8,["budgets"])])])])]),_:1},8,["accounts","panel-size"]),s(ie,{show:e(i)&&e(l),"max-width":"mobile",closeable:!0,onClose:a[9]||(a[9]=g=>e(w)())},{default:o(()=>[s(K,{full:"",category:e(i),"onUpdate:category":a[6]||(a[6]=g=>te(i)?i.value=g:null),item:e(i).budget,onSaved:D,onDeleted:B,onCancel:a[7]||(a[7]=g=>e(w)()),onClose:a[8]||(a[8]=g=>e(w)())},null,8,["category","item"])]),_:1},8,["show"])]),_:1},8,["title"]))}};export{$t as default};
