import{u as W,q as _,r as Z,o as r,g as b,b as s,d as o,k as q,i as f,t as H,m as x,a as u,f as t,e as C,c as k,F as V,h as O,H as J}from"./app.cefd7668.js";import{i as y,Z as g,g as L}from"./atmosphere-ui.588c294c.js";import{_ as N}from"./Modal.a2277346.js";import{a5 as h}from"./index.de789d8e.js";const z={class:"bg-base-lvl-3"},G={class:"px-5 pt-5 pb-4"},I={class:"text-lg font-bold text-primary"},K={class:"px-5 py-3"},Q=["onSubmit"],X={class:"flex"},Y=f("Manual"),ee=f("Recipes"),te={key:2},ae={key:0,class:"ml-5"},le=o("template",{name:"suffix"},[o("div",null,[o("button",null,"Value"),o("button",null,"Formula"),o("button",null,"Field")])],-1),ne=f(" Add component "),se={class:"px-6 py-4 space-x-3 text-right bg-gray-100"},oe=f(" Cancel "),ie=f(" Save "),pe={__name:"AutomationModal",props:{show:{type:Boolean,default:!1},maxWidth:{type:String,default:"lg"},closeable:{type:Boolean,default:!0},title:{type:String,default:"Modal"},services:{type:Array,default(){return[]}},integrations:{type:Array,default(){return[]}},recipes:{type:Array,default(){return[]}},tasks:{type:Array,default(){return[]}}},emits:["save"],setup(m,{emit:$}){const v=m,n=W({service:null,recipe:null,integration:null,tasks:[]}),A=_(()=>{var e;return((e=n.service)==null?void 0:e.type)=="external"}),S=Z("manual"),w=e=>{S.value=e,e=="manual"&&n.tasks.length==0&&U()},B=e=>e.map(a=>({label:a,value:a})),U=()=>{n.tasks.push({automation_task_id:null,name:"",label:"",config:{},values:{}})},F=(e,a)=>{J(()=>{var d;const l=n.tasks[e],c=v.tasks.find(p=>p.id===a),i=(d=JSON.parse((c==null?void 0:c.config)||"{}"))!=null?d:{};n.tasks[e]={...l,automation_task_id:a,name:c.name,label:c.label,config:i,values:Object.keys(i).reduce((p,R)=>(p[R]="",p),{})}})},M=v.services.map(e=>({label:e.name,value:e.id})),j=_(()=>v.integrations.map(e=>({label:`${e.name} ${e.hash}`,value:e.id}))),D=_(()=>v.recipes.map(e=>({label:e.name,value:e.id}))),E=_(()=>v.tasks.map(e=>({label:e.label,value:e.id})));_(()=>v.recipes.find(e=>e.id===n.recipe));const P=()=>{const e={...n.data()};debugger;return e.name=e.name||e.tasks.map(a=>a.name).join(" "),e.description=e.description||e.tasks.map(a=>a.label).join(" "),e.sentence=e.sentence||e.tasks.map(a=>a.label).join(" "),e.config={},n.integration&&(e.integration_id=e.integration),e},T=()=>{const e=P(),a=e.id?"PUT":"POST",l=e.id?`/${e.id}`:"";axios({url:`/api/automation${l}`,method:a,data:e}).then(()=>{$("saved")})};return(e,a)=>(r(),b(N,{show:m.show,"max-width":m.maxWidth,closeable:m.closeable,onClose:e.close},{default:s(()=>[o("div",z,[o("div",G,[o("h3",I,[q(e.$slots,"title",{},()=>[f(H(m.title),1)])])]),o("div",K,[o("form",{onSubmit:x(T,["prevent"])},[u(t(y),{label:"Services"},{default:s(()=>[u(t(h),{filterable:"",clearable:"",value:t(n).service,"onUpdate:value":a[0]||(a[0]=l=>t(n).service=l),"default-expand-all":!0,options:t(M)},null,8,["value","options"])]),_:1}),t(A)?(r(),b(t(y),{key:0,label:"Integration"},{default:s(()=>[u(t(h),{filterable:"",clearable:"",options:t(j),value:t(n).integration,"onUpdate:value":a[1]||(a[1]=l=>t(n).integration=l)},null,8,["options","value"])]),_:1})):C("",!0),o("div",X,[u(t(g),{onClick:a[2]||(a[2]=x(l=>w("manual"),["prevent"]))},{default:s(()=>[Y]),_:1}),u(t(g),{onClick:a[3]||(a[3]=x(l=>w("recipe"),["prevent"]))},{default:s(()=>[ee]),_:1})]),S.value=="recipe"?(r(),b(t(y),{key:1,label:"Recipe"},{default:s(()=>[u(t(h),{filterable:"",clearable:"",options:t(D),value:t(n).recipe,"onUpdate:value":a[4]||(a[4]=l=>t(n).recipe=l)},null,8,["options","value"])]),_:1})):C("",!0),S.value=="manual"||t(n).recipe?(r(),k("div",te,[(r(!0),k(V,null,O(t(n).tasks,(l,c)=>(r(),k("div",{key:l},[u(t(y),{label:"Automation Task"},{default:s(()=>[u(t(h),{filterable:"",clearable:"",options:t(E),value:m.tasks[c].automation_task_id,"onUpdate:value":[i=>m.tasks[c].automation_task_id=i,i=>F(c,i)]},null,8,["options","value","onUpdate:value"])]),_:2},1024),l.config?(r(),k("div",ae,[(r(!0),k(V,null,O(l.config,(i,d)=>(r(),b(t(y),{label:i.label||i.title||d,key:d},{default:s(()=>[i.type=="select"?(r(),b(t(h),{key:0,filterable:"",clearable:"",options:B(i.options),value:l.values[d],"onUpdate:value":p=>l.values[d]=p},null,8,["options","value","onUpdate:value"])):(r(),b(t(L),{key:1,type:"text",modelValue:l.values[d],"onUpdate:modelValue":p=>l.values[d]=p,modelModifiers:{trim:!0}},{default:s(()=>[le]),_:2},1032,["modelValue","onUpdate:modelValue"]))]),_:2},1032,["label"]))),128))])):C("",!0)]))),128)),u(t(g),{onClick:x(U,["prevent"])},{default:s(()=>[ne]),_:1},8,["onClick"])])):C("",!0)],40,Q)])]),o("div",se,[u(t(g),{type:"secondary",onClick:e.close},{default:s(()=>[oe]),_:1},8,["onClick"]),u(t(g),{class:"text-white bg-primary",onClick:T},{default:s(()=>[ie]),_:1})])]),_:3},8,["show","max-width","closeable","onClose"]))}};export{pe as _};
