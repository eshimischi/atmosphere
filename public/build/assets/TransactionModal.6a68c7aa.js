import{_ as S}from"./Modal.1586865f.js";import{r as C,Q as $,o as b,g as h,b as d,k as T,y as O,f as e,s as I,u as R,p as D,q as W,x as z,B,l as M,d as c,c as k,h as P,n as j,t as q,F,a as l,e as A,i as E}from"./app.ed3e752b.js";import{A as i,a as U}from"./atmosphere-ui.es.c3e31e0f.js";import{_ as L}from"./LogerInput.65190e93.js";import{N as g}from"./Select.c33131e1.js";import{N}from"./DatePicker.4a87f282.js";import{f as Y}from"./index.58d4bda5.js";const H={__name:"LogerApiSelect",props:{modelValue:{type:[Object]},endpoint:{type:String},placeholder:{type:String},allowCreate:{type:Boolean},customLabel:{type:String,default:"label"},trackId:{type:String}},emits:["update:modelValue","update:label"],setup(p,{emit:m}){const r=p,_=C([]),f=C(!1),x=s=>r.customLabel?s[r.customLabel]:s.label,w=(s,o)=>{let t=!0;const v=s.map(a=>{const V=r.customLabel?a[r.customLabel]:a.label;return t&&V.includes(o)&&(t=!1),{label:V,value:r.trackId?a[r.trackId]:a.id}});return[...t?[{label:o,value:"new"}]:[],...v]},n=$.exports.debounce(s=>{if(!s.length){payees.value=[];return}f.value=!0,window.axios.get(`${r.endpoint}?q=${s}`).then(({data:o})=>{_.value=w(o.data,s),f.value=!1})},200),u=s=>{var o;m("update:modelValue",s),m("update:label",(o=_.value.find(t=>t.value==s))==null?void 0:o.label)};return(s,o)=>(b(),h(e(g),O({value:x(p.modelValue),filterable:"",clearable:"",remote:"",size:"large",placeholder:p.placeholder,options:_.value,loading:f.value},s.$attrs,{"render-label":s.renderLabel,"clear-filter-after-select":!1,"onUpdate:value":u,onSearch:e(n)}),{action:d(()=>[T(s.$slots,"action")]),_:3},16,["value","placeholder","options","loading","render-label","onSearch"]))}},K={class:"pb-4 bg-base-lvl-1 sm:p-6 sm:pb-4 text-body"},Q={class:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left"},G={class:"grid grid-cols-3 overflow-hidden text-lg rounded-lg"},J=["options","onClick"],X={class:"mt-2"},Z={class:"flex space-x-2"},ee={class:"flex space-x-3"},te={key:0},ae={class:"flex"},le={class:"flex"},oe={class:"px-6 py-4 space-x-3 text-right bg-base"},ne=E(" Cancel "),se=E(" Save "),be={__name:"TransactionModal",props:{show:{default:!1},maxWidth:{default:"2xl"},closeable:{default:!0},categories:{type:Array,default:[]},accounts:{type:Array,default:[]},recurrence:{type:Boolean,default:!1},transactionData:{type:Object,default:()=>({})}},setup(p){const m=p,r=I({transactionTypes:[{value:"DEPOSIT",label:"Income"},{value:"WITHDRAW",label:"Expense"},{value:"ENTRY",label:"Transaction"}],frequencyLabel:"every",schedule_settings:{end_date:null,count:null,end_type:"NEVER",final_item_date:null,interval:1,frequency:"monthly",repeat_at_end_of_month:!1,repeat_on_day_of_month:null,start_date:null,timezone_id:"America/Santo_Domingo"},form:R({name:"",payee_id:"",payee_label:"",date:null,description:"",direction:"WITHDRAW",transaction_category_id:null,account_id:null,display_id:"",total:0})}),_=D("categoryOptions",[]),f=D("accountsOptions",[]),x=W(()=>r.form.direction=="ENTRY"?f:_),w=()=>{const o={transaction:{save:{method:"post",url:()=>route("transactions.store")},update:{method:"put",url:()=>route("transactions.update",m.transactionData)}},recurrence:{save:{url:()=>route("budget.planned-transaction")}}},t=m.transactionData&&m.transactionData.id?"update":"save",v=m.recurrence?"recurrence":"transaction",y=o[v][t];r.form.transform(a=>({...a,resource_type_id:"MANUAL",total:a.total,date:Y(new Date(a.date),"yyyy-MM-dd"),status:"verified",...r.schedule_settings})).submit(y.method,y.url(),{onSuccess:()=>{emit("close"),r.form.reset()}})};z(()=>m.transactionData,o=>{Object.keys(r.form.data()).forEach(t=>{t=="date"?r.form[t]=new Date(o[t]):r.form[t]=o[t]})},{deep:!0});const{form:n,schedule_settings:u,transactionTypes:s}=B(r);return(o,t)=>{const v=M("AtInput");return b(),h(S,{show:p.show,"max-width":p.maxWidth,closeable:p.closeable,onClose:t[12]||(t[12]=y=>o.$emit("update:show",!1))},{default:d(({close:y})=>[c("div",K,[c("div",Q,[c("div",G,[(b(!0),k(F,null,P(e(s),a=>(b(),k("div",{key:a.value,options:e(s),onClick:V=>e(n).direction=a.value,class:j(["py-1 font-bold text-center cursor-pointer hover:bg-base-lvl-3",[e(n).direction==a.value?"bg-primary hover:bg-primary text-white":"text-body bg-base-lvl-2"]])},q(a.label),11,J))),128))]),c("div",X,[T(o.$slots,"content",{},()=>[c("div",null,[c("div",Z,[l(e(i),{label:"Date",class:"w-3/12"},{default:d(()=>[l(e(N),{value:e(n).date,"onUpdate:value":t[0]||(t[0]=a=>e(n).date=a),type:"date",size:"large"},null,8,["value"])]),_:1}),l(e(i),{label:"Description",class:"w-5/12"},{default:d(()=>[l(L,{modelValue:e(n).description,"onUpdate:modelValue":t[1]||(t[1]=a=>e(n).description=a)},null,8,["modelValue"])]),_:1}),l(e(i),{label:"Account",class:"w-4/12"},{default:d(()=>[l(e(g),{filterable:"",clearable:"",tag:"",size:"large",value:e(n).account_id,"onUpdate:value":[t[2]||(t[2]=a=>e(n).account_id=a),o.createCategory],"default-expand-all":!0,options:e(f)},null,8,["value","onUpdate:value","options"])]),_:1})]),c("div",ee,[l(e(i),{label:"Payee",class:"w-5/12"},{default:d(()=>[l(H,{modelValue:e(n).payee_id,"onUpdate:modelValue":t[3]||(t[3]=a=>e(n).payee_id=a),label:e(n).payee_label,"onUpdate:label":t[4]||(t[4]=a=>e(n).payee_label=a),tag:"","custom-label":"name","track-id":"id",placeholder:"Add a payee",endpoint:"/api/payees"},null,8,["modelValue","label"])]),_:1}),l(e(i),{label:"Category",class:"w-full"},{default:d(()=>[l(e(g),{filterable:"",clearable:"",tag:"",size:"large",value:e(n).transaction_category_id,"onUpdate:value":[t[5]||(t[5]=a=>e(n).transaction_category_id=a),o.createCategory],"default-expand-all":!0,options:e(x)},null,8,["value","onUpdate:value","options"])]),_:1}),l(e(i),{label:"Amount",class:"w-4/12"},{default:d(()=>[l(L,{type:"number",modelValue:e(n).total,"onUpdate:modelValue":t[6]||(t[6]=a=>e(n).total=a)},null,8,["modelValue"])]),_:1})])]),p.recurrence?(b(),k("div",te,[c("div",ae,[l(e(i),{label:"Repeat this transaction",class:"w-full"},{default:d(()=>[l(e(g),{value:e(u).frequency,"onUpdate:value":t[7]||(t[7]=a=>e(u).frequency=a),options:[{value:"WEEKLY",label:"Weekly"},{value:"MONTHLY",label:"Monthly"}]},null,8,["value"])]),_:1}),l(e(i),{label:"frequencyLabel"},{default:d(()=>[l(v,{type:"number",modelValue:e(u).repeat_on_day_of_month,"onUpdate:modelValue":t[8]||(t[8]=a=>e(u).repeat_on_day_of_month=a)},null,8,["modelValue"])]),_:1})]),c("div",le,[l(e(i),{label:"Ends",class:"w-full"},{default:d(()=>[l(e(g),{value:e(u).end_type,"onUpdate:value":t[9]||(t[9]=a=>e(u).end_type=a),options:[{value:"NEVER",label:"Never"},{value:"DATE",label:"At"},{value:"COUNT",label:"After"}]},null,8,["value"])]),_:1}),e(u).end_type=="DATE"?(b(),h(e(i),{key:0,label:"Date"},{default:d(()=>[l(e(N),{value:e(u).end_date,"onUpdate:value":t[10]||(t[10]=a=>e(u).end_date=a),size:"lg"},null,8,["value"])]),_:1})):A("",!0),e(u).end_type=="COUNT"?(b(),h(e(i),{key:1,label:"Instances"},{default:d(()=>[l(v,{type:"number",modelValue:e(u).count,"onUpdate:modelValue":t[11]||(t[11]=a=>e(u).count=a)},null,8,["modelValue"])]),_:1})):A("",!0)])])):A("",!0)])])])]),c("div",oe,[l(e(U),{onClick:y,rounded:"",class:"h-10 text-white"},{default:d(()=>[ne]),_:2},1032,["onClick"]),l(e(U),{class:"text-white bg-primary h-10",onClick:w,rounded:""},{default:d(()=>[se]),_:1})])]),_:3},8,["show","max-width","closeable"])}}};export{be as _,H as a};
