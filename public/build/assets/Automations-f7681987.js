import{x,o as r,c as b,w as d,a as m,b as e,i as k,u as O,e as c,h as u,t as a,F as p,M as C,O as g}from"./app-fc313f38.js";import{Z as I}from"./atmosphere-ui-5b718e83.js";import{_ as M}from"./AppLayout.vue_vue_type_script_setup_true_lang-87835da0.js";import{_ as E}from"./AutomationModal-fda2532a.js";import{_ as L}from"./SettingsSectionNav-44275bfa.js";import"./isMobile-3d69cdae.js";import"./formatMoney-da670e0a.js";import"./index-975c57c9.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./AppIcon-36bb04e5.js";/* empty css                                                */import"./Modal-ca404241.js";/* empty css                                              */import"./LogerInput-2f23c230.js";import"./LogerButton-370ed8f9.js";import"./SectionNav-7e8b141c.js";import"./Dropdown-1335b583.js";const B={class:"py-12"},N={class:"h-auto mx-auto max-w-7xl sm:px-6 lg:px-8"},S={class:"flex items-center justify-between mb-5 border-4 border-white rounded-md bg-gray-50"},$=e("div",{class:"px-5 font-bold text-gray-600"},"Automations",-1),G=["onClick"],P=["src"],T={class:"ml-5"},D={class:"ml-2"},V={class:"w-full integrations-form"},F={class:"left"},K={class:"head"},R={class:"tagline"},X={class:"text-right automations"},Z=e("div",{class:"text-right options"},"options",-1),lt={__name:"Automations",props:{services:{type:Array,default(){return[]}},integrations:{type:Array,default(){return[]}},recipes:{type:Array,default(){return[]}},tasks:{type:Array,default(){return[]}}},setup(n){const i=x({showAddConnection:!1,authInstance:null,isAutomationModalOpen:!1,openedAutomation:{}}),h=(s,o)=>{i.isAutomationModalOpen=!0,i.openedAutomation={board:s,stage:o}},_=()=>{C(()=>{i.isAutomationModalOpen=!1,g.reload("/integrations",{only:["integrations"],preserveState:!0})})},f=s=>{switch(s.name.toLowerCase()){case"google":case"gmail":y(s.name.toLowerCase(),s);break}},y=(s,o)=>{gapi.load("auth2",()=>{gapi.auth2.init({apiKey:{}.MIX_GOOGLE_APP_KEY,clientId:{}.MIX_GOOGLE_CLIENT_ID,accessType:"offline",scope:"profile https://www.googleapis.com/auth/gmail.readonly https://www.googleapis.com/auth/calendar.readonly",discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest","https://sheets.googleapis.com/discovery/rest?version=v4"]}).then(async()=>{const t=gapi.auth2.getAuthInstance(),l=t.currentUser.get();l.getAuthResponse().session_state||await t.signIn();const v=l.getBasicProfile();await t.grantOfflineAccess({authuser:l.getAuthResponse().session_state.extraQueryParams.authuser}).then(({code:w})=>{const A={code:w,service_id:o.id,service_name:o.name,user:v.getEmail()};axios.post("/services/google",{credentials:A}).then(()=>{g.get("/integrations",{only:["integrations"],preserveState:!0})})})})})};return(s,o)=>(r(),b(M,null,{header:d(()=>[m(L)]),default:d(()=>[e("div",B,[e("div",N,[e("div",S,[$,m(O(I),{class:"text-white bg-primary",onClick:h},{default:d(()=>[k(" Add Automation ")]),_:1})]),(r(!0),c(p,null,u(n.services,t=>(r(),c("div",{key:t.id,onClick:l=>f(t),class:"flex px-5 py-3 shadow-md cursor-pointer bg-base-lvl-1"},[e("div",null,[e("img",{src:t.logo,class:"w-9"},null,8,P)]),e("h2",T,a(t.name),1),e("p",D,a(t.description),1)],8,G))),128)),e("div",V,[(r(!0),c(p,null,u(n.integrations,t=>(r(),c("div",{class:"grid grid-cols-3 px-5 py-3 my-2 font-bold text-gray-500 cursor-pointer bg-base-lvl-1 app-service__item",key:t.id},[e("div",F,[e("div",K,a(t.name)+" "+a(t.hash),1),e("div",R,a(t.hash)+" "+a(t.created_at),1)]),e("div",X,a(t.automations.length),1),Z]))),128))]),m(E,{show:i.isAutomationModalOpen,"record-data":s.openedAutomation,closeable:!0,title:"Add a new automation",services:n.services,integrations:n.integrations,recipes:n.recipes,tasks:n.tasks,type:"event",onCancel:o[0]||(o[0]=t=>i.isAutomationModalOpen=!1),onSaved:_},null,8,["show","record-data","services","integrations","recipes","tasks"])])])]),_:1}))}};export{lt as default};
