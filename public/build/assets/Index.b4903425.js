import{u as N,r as G,q as I,o as i,g as x,b as u,d as a,k as R,i as b,t as g,m as M,a as d,f as t,e as D,c as v,F as T,h as U,H as P,s as K,S as L}from"./app.ed3e752b.js";import{A as C,a as w,_ as W}from"./atmosphere-ui.es.c3e31e0f.js";import{_ as X}from"./AppLayout.3e3cea3d.js";import{_ as Y}from"./Modal.1586865f.js";import{N as O}from"./Select.c33131e1.js";import"./_plugin-vue_export-helper.cdc0426e.js";/* empty css                                              */import"./light.2fdb7969.js";import"./fade-in-scale-up.cssr.07c62ce8.js";import"./Suffix.8e8bf306.js";import"./Popover.b027aa1f.js";import"./format-length.7f3135aa.js";const q={class:"px-10 pt-5 pb-4"},H={class:"text-lg font-bold text-primary"},J={class:"px-5 py-3"},Q=["onSubmit"],z={class:"flex"},Z=b("Manual"),ee=b("Recipes"),te={key:1},ae={key:0,class:"ml-5"},se=a("template",{name:"suffix"},[a("div",null,[a("button",null,"Value"),a("button",null,"Formula"),a("button",null,"Field")])],-1),oe=b(" Add component "),ne={class:"px-6 py-4 space-x-3 text-right bg-gray-100"},le=b(" Cancel "),ie=b(" Save "),re={__name:"AutomationModal",props:{show:{type:Boolean,default:!1},maxWidth:{type:String,default:"lg"},closeable:{type:Boolean,default:!0},title:{type:String,default:"Modal"},services:{type:Array,default(){return[]}},integrations:{type:Array,default(){return[]}},recipes:{type:Array,default(){return[]}},tasks:{type:Array,default(){return[]}}},emits:["save"],setup(r,{emit:h}){const f=r,l=N({service:null,recipe:null,integration:null,tasks:[]}),A=G("manual"),S=e=>{A.value=e,e=="manual"&&l.tasks.length==0&&m()},p=e=>e.map(s=>({label:s,value:s})),m=()=>{l.tasks.push({automation_task_id:null,name:"",label:"",config:{},values:{}})},o=(e,s)=>{P(()=>{const n=l.tasks[e],y=f.tasks.find(_=>_.id==s),c=JSON.parse(y.config||{});l.tasks[e]={...n,automation_task_id:s,name:y.name,label:y.label,config:c,values:Object.keys(c).reduce((_,$)=>(_[$]="",_),{})}})},k=f.services.map(e=>({label:e.name,value:e.id})),V=I(()=>f.integrations.map(e=>({label:`${e.name} ${e.hash}`,value:e.id}))),B=I(()=>f.recipes.map(e=>({label:e.name,value:e.id}))),F=I(()=>f.tasks.map(e=>({label:e.label,value:e.id})));I(()=>f.recipes.find(e=>e.id===l.recipe));const j=()=>{const e={...l.data()};return e.name=e.name||e.tasks.map(s=>s.name).join(" "),e.description=e.description||e.tasks.map(s=>s.label).join(" "),e.sentence=e.sentence||e.tasks.map(s=>s.label).join(" "),e.config={},l.integration&&(e.integration_id=e.integration),e},E=()=>{const e=j(),s=e.id?"PUT":"POST",n=e.id?`/${e.id}`:"";axios({url:`/api/automation${n}`,method:s,data:e}).then(()=>{h("saved")})};return(e,s)=>(i(),x(Y,{show:r.show,"max-width":r.maxWidth,closeable:r.closeable,onClose:e.close},{default:u(()=>[a("div",q,[a("h3",H,[R(e.$slots,"title",{},()=>[b(g(r.title),1)])])]),a("div",J,[a("form",{onSubmit:M(E,["prevent"])},[d(t(C),{label:"Services"},{default:u(()=>[d(t(O),{filterable:"",clearable:"",value:t(l).service,"onUpdate:value":s[0]||(s[0]=n=>t(l).service=n),"default-expand-all":!0,options:t(k)},null,8,["value","options"])]),_:1}),d(t(C),{label:"Integration"},{default:u(()=>[d(t(O),{filterable:"",clearable:"",options:t(V),value:t(l).integration,"onUpdate:value":s[1]||(s[1]=n=>t(l).integration=n)},null,8,["options","value"])]),_:1}),a("div",z,[d(t(w),{onClick:s[2]||(s[2]=M(n=>S("manual"),["prevent"]))},{default:u(()=>[Z]),_:1}),d(t(w),{onClick:s[3]||(s[3]=M(n=>S("recipe"),["prevent"]))},{default:u(()=>[ee]),_:1})]),A.value=="recipe"?(i(),x(t(C),{key:0,label:"Recipe"},{default:u(()=>[d(t(O),{filterable:"",clearable:"",options:t(B),value:t(l).recipe,"onUpdate:value":s[4]||(s[4]=n=>t(l).recipe=n)},null,8,["options","value"])]),_:1})):D("",!0),A.value=="manual"||t(l).recipe?(i(),v("div",te,[(i(!0),v(T,null,U(t(l).tasks,(n,y)=>(i(),v("div",null,[d(t(C),{label:"Automation Task"},{default:u(()=>[d(t(O),{filterable:"",clearable:"",options:t(F),value:r.tasks[y].automation_task_id,"onUpdate:value":[c=>r.tasks[y].automation_task_id=c,c=>o(y,c)]},null,8,["options","value","onUpdate:value"])]),_:2},1024),n.config?(i(),v("div",ae,[(i(!0),v(T,null,U(n.config,(c,_)=>(i(),x(t(C),{label:c.label||c.title||_},{default:u(()=>[c.type=="select"?(i(),x(t(O),{key:0,filterable:"",clearable:"",options:p(c.options),value:n.values[_],"onUpdate:value":$=>n.values[_]=$},null,8,["options","value","onUpdate:value"])):(i(),x(t(W),{key:1,type:"text",modelValue:n.values[_],"onUpdate:modelValue":$=>n.values[_]=$,modelModifiers:{trim:!0}},{default:u(()=>[se]),_:2},1032,["modelValue","onUpdate:modelValue"]))]),_:2},1032,["label"]))),256))])):D("",!0)]))),256)),d(t(w),{onClick:M(m,["prevent"])},{default:u(()=>[oe]),_:1},8,["onClick"])])):D("",!0)],40,Q)]),a("div",ne,[d(t(w),{type:"secondary",onClick:e.close},{default:u(()=>[le]),_:1},8,["onClick"]),d(t(w),{class:"text-white bg-primary",onClick:E},{default:u(()=>[ie]),_:1})])]),_:3},8,["show","max-width","closeable","onClose"]))}};const ue={class:"py-12"},de={class:"h-auto mx-auto max-w-7xl sm:px-6 lg:px-8"},ce={class:"flex items-center justify-between mb-5 border-4 border-white rounded-md bg-gray-50"},pe=a("div",{class:"px-5 font-bold text-gray-600"},"Automations",-1),me=b(" Add Automation "),_e=["onClick"],ve=["src"],fe={class:"ml-5"},ge={class:"ml-2"},he={class:"w-full integrations-form"},ye={class:"left"},be={class:"head"},ke={class:"tagline"},xe={class:"text-right automations"},we=a("div",{class:"text-right options"},"options",-1),De={__name:"Index",props:{services:{type:Array,default(){return[]}},integrations:{type:Array,default(){return[]}},recipes:{type:Array,default(){return[]}},tasks:{type:Array,default(){return[]}}},setup(r){const h=K({showAddConnection:!1,authInstance:null,isAutomationModalOpen:!1,openedAutomation:{}}),f=(p,m)=>{h.isAutomationModalOpen=!0,h.openedAutomation={board:p,stage:m}},l=()=>{P(()=>{h.isAutomationModalOpen=!1,L.Inertia.reload("/integrations",{only:["integrations"],preserveState:!0})})},A=p=>{switch(p.name.toLowerCase()){case"google":case"gmail":S(p.name.toLowerCase(),p);break}},S=(p,m)=>{gapi.load("auth2",()=>{gapi.auth2.init({apiKey:process.env.MIX_GOOGLE_APP_KEY,clientId:process.env.MIX_GOOGLE_CLIENT_ID,accessType:"offline",scope:"profile https://www.googleapis.com/auth/gmail.readonly https://www.googleapis.com/auth/calendar.readonly",discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest","https://sheets.googleapis.com/discovery/rest?version=v4"]}).then(async()=>{const o=gapi.auth2.getAuthInstance(),k=o.currentUser.get();k.getAuthResponse().session_state||await o.signIn();const V=k.getBasicProfile();await o.grantOfflineAccess({authuser:k.getAuthResponse().session_state.extraQueryParams.authuser}).then(({code:B})=>{const F={code:B,service_id:m.id,service_name:m.name,user:V.getEmail()};axios.post("/services/google",{credentials:F}).then(()=>{L.Inertia.get("/integrations",{only:["integrations"],preserveState:!0})})})})})};return(p,m)=>(i(),x(X,null,{default:u(()=>[a("div",ue,[a("div",de,[a("div",ce,[pe,d(t(w),{class:"text-white bg-primary",onClick:f},{default:u(()=>[me]),_:1})]),(i(!0),v(T,null,U(r.services,o=>(i(),v("div",{key:o.id,onClick:k=>A(o),class:"flex px-5 py-3 bg-base-lvl-1 shadow-md cursor-pointer"},[a("div",null,[a("img",{src:o.logo,class:"w-9"},null,8,ve)]),a("h2",fe,g(o.name),1),a("p",ge,g(o.description),1)],8,_e))),128)),a("div",he,[(i(!0),v(T,null,U(r.integrations,o=>(i(),v("div",{class:"grid grid-cols-3 px-5 py-3 my-2 font-bold text-gray-500 bg-base-lvl-1 cursor-pointer app-service__item",key:o.id},[a("div",ye,[a("div",be,g(o.name)+" "+g(o.hash),1),a("div",ke,g(o.hash)+" "+g(o.created_at),1)]),a("div",xe,g(o.automations.length),1),we]))),128))]),d(re,{show:h.isAutomationModalOpen,"record-data":p.openedAutomation,closeable:!0,title:"Add a new automation",services:r.services,integrations:r.integrations,recipes:r.recipes,tasks:r.tasks,type:"event",onCancel:m[0]||(m[0]=o=>h.isAutomationModalOpen=!1),onSaved:l},null,8,["show","record-data","services","integrations","recipes","tasks"])])])]),_:1}))}};export{De as default};
