import{W as N,r as G,c as I,o as l,k as w,w as u,b as a,g as R,f as y,t as v,x as M,d as c,u as t,i as D,a as f,F as T,e as U,H as L,h as W,l as F}from"./app.e738c84d.js";import{b as C,_ as x,c as X}from"./atmosphere-ui.es.bb151f48.js";import{_ as K}from"./AppLayout.d67665c7.js";import{_ as H}from"./Modal.40de7d4e.js";import{N as O}from"./Select.8b95d733.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./Suffix.5aad8092.js";import"./index.a95d9f5e.js";import"./Icon.f03f38c6.js";import"./format-length.7f3135aa.js";const J={class:"px-10 pt-5 pb-4"},Q={class:"text-lg font-bold text-pink-500"},Y={class:"px-5 py-3"},Z=["onSubmit"],q={class:"flex"},z=y("Manual"),ee=y("Recipes"),te={key:1},ae={key:0,class:"ml-5"},oe=a("template",{name:"suffix"},[a("div",null,[a("button",null,"Value"),a("button",null,"Formula"),a("button",null,"Field")])],-1),se=y(" Add component "),ne={class:"px-6 py-4 space-x-3 text-right bg-gray-100"},ie=y(" Cancel "),le=y(" Save "),re={props:{show:{type:Boolean,default:!1},maxWidth:{type:String,default:"lg"},closeable:{type:Boolean,default:!0},title:{type:String,default:"Modal"},services:{type:Array,default(){return[]}},integrations:{type:Array,default(){return[]}},recipes:{type:Array,default(){return[]}},tasks:{type:Array,default(){return[]}}},emits:["save"],setup(r,{emit:h}){const _=r,i=N({service:null,recipe:null,integration:null,tasks:[]}),A=G("manual"),S=e=>{A.value=e,e=="manual"&&i.tasks.length==0&&m()},p=e=>e.map(o=>({label:o,value:o})),m=()=>{i.tasks.push({automation_task_id:null,name:"",label:"",config:{},values:{}})},s=(e,o)=>{L(()=>{const n=i.tasks[e],b=_.tasks.find(g=>g.id==o),d=JSON.parse(b.config||{});i.tasks[e]={...n,automation_task_id:o,name:b.name,label:b.label,config:d,values:Object.keys(d).reduce((g,$)=>(g[$]="",g),{})}})},k=_.services.map(e=>({label:e.name,value:e.id})),V=I(()=>_.integrations.map(e=>({label:`${e.name} ${e.hash}`,value:e.id}))),B=I(()=>_.recipes.map(e=>({label:e.name,value:e.id}))),j=I(()=>_.tasks.map(e=>({label:e.label,value:e.id})));I(()=>_.recipes.find(e=>e.id===i.recipe));const P=()=>{const e={...i.data()};return e.name=e.name||e.tasks.map(o=>o.name).join(" "),e.description=e.description||e.tasks.map(o=>o.label).join(" "),e.sentence=e.sentence||e.tasks.map(o=>o.label).join(" "),e.config={},i.integration&&(e.integration_id=e.integration),e},E=()=>{const e=P(),o=e.id?"PUT":"POST",n=e.id?`/${e.id}`:"";axios({url:`/api/automation${n}`,method:o,data:e}).then(()=>{h("saved")})};return(e,o)=>(l(),w(H,{show:r.show,"max-width":r.maxWidth,closeable:r.closeable,onClose:e.close},{default:u(()=>[a("div",J,[a("h3",Q,[R(e.$slots,"title",{},()=>[y(v(r.title),1)])])]),a("div",Y,[a("form",{onSubmit:M(E,["prevent"])},[c(t(C),{label:"Services"},{default:u(()=>[c(t(O),{filterable:"",clearable:"",value:t(i).service,"onUpdate:value":o[0]||(o[0]=n=>t(i).service=n),"default-expand-all":!0,options:t(k)},null,8,["value","options"])]),_:1}),c(t(C),{label:"Integration"},{default:u(()=>[c(t(O),{filterable:"",clearable:"",options:t(V),value:t(i).integration,"onUpdate:value":o[1]||(o[1]=n=>t(i).integration=n)},null,8,["options","value"])]),_:1}),a("div",q,[c(t(x),{onClick:o[2]||(o[2]=M(n=>S("manual"),["prevent"]))},{default:u(()=>[z]),_:1}),c(t(x),{onClick:o[3]||(o[3]=M(n=>S("recipe"),["prevent"]))},{default:u(()=>[ee]),_:1})]),A.value=="recipe"?(l(),w(t(C),{key:0,label:"Recipe"},{default:u(()=>[c(t(O),{filterable:"",clearable:"",options:t(B),value:t(i).recipe,"onUpdate:value":o[4]||(o[4]=n=>t(i).recipe=n)},null,8,["options","value"])]),_:1})):D("",!0),A.value=="manual"||t(i).recipe?(l(),f("div",te,[(l(!0),f(T,null,U(t(i).tasks,(n,b)=>(l(),f("div",null,[c(t(C),{label:"Automation Task"},{default:u(()=>[c(t(O),{filterable:"",clearable:"",options:t(j),value:r.tasks[b].automation_task_id,"onUpdate:value":[d=>r.tasks[b].automation_task_id=d,d=>s(b,d)]},null,8,["options","value","onUpdate:value"])]),_:2},1024),n.config?(l(),f("div",ae,[(l(!0),f(T,null,U(n.config,(d,g)=>(l(),w(t(C),{label:d.label||d.title||g},{default:u(()=>[d.type=="select"?(l(),w(t(O),{key:0,filterable:"",clearable:"",options:p(d.options),value:n.values[g],"onUpdate:value":$=>n.values[g]=$},null,8,["options","value","onUpdate:value"])):(l(),w(t(X),{key:1,type:"text",modelValue:n.values[g],"onUpdate:modelValue":$=>n.values[g]=$,modelModifiers:{trim:!0}},{default:u(()=>[oe]),_:2},1032,["modelValue","onUpdate:modelValue"]))]),_:2},1032,["label"]))),256))])):D("",!0)]))),256)),c(t(x),{onClick:M(m,["prevent"])},{default:u(()=>[se]),_:1},8,["onClick"])])):D("",!0)],40,Z)]),a("div",ne,[c(t(x),{type:"secondary",onClick:e.close},{default:u(()=>[ie]),_:1},8,["onClick"]),c(t(x),{class:"text-white bg-pink-400",onClick:E},{default:u(()=>[le]),_:1})])]),_:3},8,["show","max-width","closeable","onClose"]))}};const ue={class:"py-12"},ce={class:"h-auto mx-auto max-w-7xl sm:px-6 lg:px-8"},de={class:"flex items-center justify-between mb-5 border-4 border-white rounded-md bg-gray-50"},pe=a("div",{class:"px-5 font-bold text-gray-600"},"Automations",-1),me=y(" Add Automation "),ge=["onClick"],fe=["src"],_e={class:"ml-5"},ve={class:"ml-2"},he={class:"w-full integrations-form"},be={class:"left"},ye={class:"head"},ke={class:"tagline"},we={class:"text-right automations"},xe=a("div",{class:"text-right options"},"options",-1),Be={props:{services:{type:Array,default(){return[]}},integrations:{type:Array,default(){return[]}},recipes:{type:Array,default(){return[]}},tasks:{type:Array,default(){return[]}}},setup(r){const h=W({showAddConnection:!1,authInstance:null,isAutomationModalOpen:!1,openedAutomation:{}}),_=(p,m)=>{h.isAutomationModalOpen=!0,h.openedAutomation={board:p,stage:m}},i=()=>{L(()=>{h.isAutomationModalOpen=!1,F.Inertia.reload("/integrations",{only:["integrations"],preserveState:!0})})},A=p=>{switch(p.name.toLowerCase()){case"google":case"gmail":S(p.name.toLowerCase(),p);break}},S=(p,m)=>{gapi.load("auth2",()=>{gapi.auth2.init({apiKey:{}.MIX_GOOGLE_APP_KEY,clientId:{}.MIX_GOOGLE_CLIENT_ID,accessType:"offline",scope:"profile https://www.googleapis.com/auth/gmail.readonly https://www.googleapis.com/auth/calendar.readonly",discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest","https://sheets.googleapis.com/discovery/rest?version=v4"]}).then(async()=>{const s=gapi.auth2.getAuthInstance(),k=s.currentUser.get();k.getAuthResponse().session_state||await s.signIn();const V=k.getBasicProfile();await s.grantOfflineAccess({authuser:k.getAuthResponse().session_state.extraQueryParams.authuser}).then(({code:B})=>{const j={code:B,service_id:m.id,service_name:m.name,user:V.getEmail()};axios.post("/services/google",{credentials:j}).then(()=>{F.Inertia.get("/integrations",{only:["integrations"],preserveState:!0})})})})})};return(p,m)=>(l(),w(K,null,{default:u(()=>[a("div",ue,[a("div",ce,[a("div",de,[pe,c(t(x),{class:"text-white bg-pink-400",onClick:_},{default:u(()=>[me]),_:1})]),(l(!0),f(T,null,U(r.services,s=>(l(),f("div",{key:s.id,onClick:k=>A(s),class:"flex px-5 py-3 bg-slate-600 shadow-md cursor-pointer"},[a("div",null,[a("img",{src:s.logo,class:"w-9"},null,8,fe)]),a("h2",_e,v(s.name),1),a("p",ve,v(s.description),1)],8,ge))),128)),a("div",he,[(l(!0),f(T,null,U(r.integrations,s=>(l(),f("div",{class:"grid grid-cols-3 px-5 py-3 my-2 font-bold text-gray-500 bg-slate-600 cursor-pointer app-service__item",key:s.id},[a("div",be,[a("div",ye,v(s.name)+" "+v(s.hash),1),a("div",ke,v(s.hash)+" "+v(s.created_at),1)]),a("div",we,v(s.automations.length),1),xe]))),128))]),c(re,{show:t(h).isAutomationModalOpen,"record-data":p.openedAutomation,closeable:!0,title:"Add a new automation",services:r.services,integrations:r.integrations,recipes:r.recipes,tasks:r.tasks,type:"event",onCancel:m[0]||(m[0]=s=>t(h).isAutomationModalOpen=!1),onSaved:i},null,8,["show","record-data","services","integrations","recipes","tasks"])])])]),_:1}))}};export{Be as default};
