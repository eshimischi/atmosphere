import{d as Z,q as V,T as q,E as Q,r as w,o as u,f,a as m,w as g,b as d,n as M,t as A,s as G,u as s,c as C,G as ae,g as k,i as O,O as S,M as L,N as se,p as H,P,k as K,I as oe,m as le,B as ne,F as T,h as R,Q as re}from"./app-114b751b.js";import{I as J,V as W}from"./vue-draggable-next.esm-bundler-3a2dc928.js";import{e as de,N as ie,f as j,u as ue,c as ce,d as me}from"./isMobile-e3872359.js";import{_ as D}from"./LogerInput-8ca4e824.js";import{f as E,s as F,_ as z}from"./formatMoney-75af80f0.js";import{_ as I}from"./_plugin-vue_export-helper-c27b6911.js";import{_ as ve}from"./BudgetProgress-06c39c7c.js";import{N as X}from"./Dropdown-839d2ecf.js";import{B as U,Z as N}from"./atmosphere-ui-b819c890.js";import{u as pe}from"./budgetTotals-564808f0.js";import"./exact-math.node-ab123f44.js";const ge={class:"w-full text-right",title:"Money Available"},fe={class:"w-72 md:w-96"},ye={class:"flex justify-between text-sm group md:text-base"},be={class:""},he={key:0,class:"text-success group-hover:text-white"},_e={class:"flex items-center justify-end space-x-2"},xe=Z({__name:"BalanceInput",props:{value:{type:Number},formatter:{type:Function,default(){return e=>e}},category:{type:Object,required:!0}},setup(e){const r=e,i={good:"text-success bg-base-lvl-2 hover:bg-base-lvl-3",danger:"text-danger",needs:"text-warning",overspend:"text-warning",default:"bg-base-lvl-3"},l={overspent:"overspent",available:"available",empty:"empty"},_=V(()=>{if(r.value>0)return l.available;if(r.value<0)return l.overspent}),y=V(()=>{let a=i.default;return r.value>0?a=i.good:r.value<0&&(a=i.overspend),[a]}),n=q({amount:Math.abs(r.value),source_category_id:null,destination_category_id:null}),x=()=>{{const a=j(F(new Date),"yyyy-MM-dd"),t=_.value==l.available?"source_category_id":"destination_category_id";n.transform(o=>{var $;return{...o,budgeted:o.amount,[t]:r.category.id,source_category_id:($=o.source_category_id)==null?void 0:$.value,type:"movement"}}).post(`/budgets/${r.category.id}/months/${a}`,{preserveState:!0,preserveScroll:!0})}},b=Q("categories",w({data:[]})),p=V(()=>{var a;return console.log(b.value.data),(a=b.value.data)==null?void 0:a.map(t=>({value:t.id,key:t.id,label:t.name,type:"group",children:t.subCategories.map(o=>({value:o.id,label:o.name,available:o.available}))}))}),c=w(!1),h=()=>{n.reset(),c.value=!1},v=()=>{c.value=!c.value};return(a,t)=>(u(),f("div",ge,[m(s(ie),{trigger:"manual",placement:"bottom","onUpdate:show":a.handleUpdateShow,show:c.value},{trigger:g(()=>[d("div",{class:M(["inline-flex items-center py-1 font-bold cursor-pointer flex-nowrap rounded-3xl min-w-max",y.value]),onClick:v},[d("span",null,A(e.formatter(e.value)),1),G(a.$slots,"suffix")],2)]),default:g(()=>[d("div",fe,[m(s(U),{label:"Move"},{default:g(()=>[m(D,{modelValue:s(n).amount,"onUpdate:modelValue":t[0]||(t[0]=o=>s(n).amount=o)},null,8,["modelValue"])]),_:1}),_.value==l.available?(u(),C(s(U),{key:0,label:"To"},{default:g(()=>[m(s(de),{filterable:"",clearable:"",size:"large",value:s(n).destination_category_id,"onUpdate:value":t[1]||(t[1]=o=>s(n).destination_category_id=o),"default-expand-all":!0,options:p.value},null,8,["value","options"])]),_:1})):(u(),C(s(U),{key:1,label:"From"},{default:g(()=>[m(s(ae),{modelValue:s(n).source_category_id,"onUpdate:modelValue":t[2]||(t[2]=o=>s(n).source_category_id=o),options:p.value,"group-values":"children","group-label":"label",placeholder:"Type to search","track-by":"value",label:"label","select-label":""},{option:g(({option:o})=>[d("div",ye,[d("span",be,A(o.label||o.$groupLabel),1),o.available?(u(),f("span",he,A(s(E)(o.available)),1)):k("",!0)])]),_:1},8,["modelValue","options"])]),_:1})),d("div",_e,[m(s(N),{class:"text-body-1",onClick:h},{default:g(()=>[O("Cancel")]),_:1}),m(s(N),{class:"text-white rounded-md bg-success",onClick:t[3]||(t[3]=o=>x())},{default:g(()=>[O(" Save")]),_:1})])])]),_:3},8,["onUpdate:show","show"])]))}}),$e=(e,r=null,i)=>{e.transform(l=>({...l,resource_type:"transactions",parent_id:r})).post("/budgets",{onSuccess(){S.reload({preserveScroll:!0}),e.reset(),L(()=>{i&&i()})}})},we={},ke={class:"absolute -top-1 -right-2 h-2 w-2 bg-error rounded-full ring ring-error/20 animate-pulse"};function Ce(e,r){return u(),f("div",ke)}const Y=I(we,[["render",Ce]]),Be={class:"flex justify-between py-2 px-4 text-body-1/80"},Ae={class:"flex items-center space-x-2"},Se={key:0,class:"cursor-grab"},Ve={class:"flex items-center"},Me={class:"flex items-center space-x-2"},Oe=d("i",{class:"fa fa-ellipsis-v"},null,-1),Ee={__name:"BudgetGroupItem",props:{item:{type:Object,required:!0},forceExpanded:{type:Boolean,default:!1},isMobile:{type:Boolean},allowDrag:{type:Boolean}},emits:["removed"],setup(e,{emit:r}){const i=e,l=w(i.forceExpanded),_=V(()=>l.value?"fa-chevron-up":"fa-chevron-down");se(()=>{i.forceExpanded&&(l.value=!0)});const y=w(!1),n=()=>y.value=!y.value,x=w();H(()=>{P(x.value)});const b=[{name:"add",label:"Add subcategory"},{name:"delete",label:"Delete"}],p=()=>{confirm("Are you sure you want to remove this category group?")&&S.delete(`budgets/${i.item.id}`,{onSuccess(){r("removed",i.item.id),S.reload({only:["budgets"],preserveScroll:!0})}})},c=h=>{switch(h){case"delete":p();break;case"add":n()}};return(h,v)=>(u(),f("article",null,[d("header",Be,[d("div",Ae,[e.isMobile&&e.allowDrag?(u(),f("div",Se,[m(J,{class:"handle"})])):(u(),C(z,{key:1,onClick:v[0]||(v[0]=a=>l.value=!l.value)},{default:g(()=>[d("i",{class:M(["fa",_.value])},null,2)]),_:1})),d("div",Ve,[d("h4",{class:M(["relative text-primary font-bold cursor-grab",{handle:!e.isMobile}])},[O(A(e.item.name)+" ",1),e.item.hasOverspent||e.item.hasOverAssigned||e.item.hasUnderfunded?(u(),C(Y,{key:0})):k("",!0)],2)])]),d("div",Me,[m(ve,{current:Math.abs(e.item.activity),goal:e.item.budgeted,class:"h-1.5 rounded-sm w-14","progress-class":["bg-success","bg-secondary/5"]},{after:g(({progress:a})=>[O(A(a)+"% ",1)]),_:1},8,["current","goal"]),m(s(X),{trigger:"click","key-field":"name",options:b,"on-select":c},{default:g(()=>[m(z,null,{default:g(()=>[Oe]),_:1})]),_:1})])]),d("section",{class:"pl-4 border-l-4 border-primary bg-base-lvl-3",ref_key:"dropdown",ref:x},[l.value||y.value?G(h.$slots,"content",{key:0,isExpanded:l.value,toggleAdding:n,isAdding:y.value}):k("",!0)],512)]))}},Ne={name:"IcBaselineBolt"},De={width:"1em",height:"1em",viewBox:"0 0 24 24"},Ie=d("path",{fill:"currentColor",d:"M11 21h-1l1-7H7.5c-.58 0-.57-.32-.38-.66c.19-.34.05-.08.07-.12C8.48 10.94 10.42 7.54 13 3h1l-1 7h3.5c.49 0 .56.33.47.51l-.07.15C12.96 17.55 11 21 11 21z"},null,-1),Te=[Ie];function Ue(e,r,i,l,_,y){return u(),f("svg",De,Te)}const je=I(Ne,[["render",Ue]]),Fe={key:0},ze={__name:"BudgetTransaction",props:{data:{type:Object},formatter:{type:Function,default(){return e=>e}},category:{type:Object,required:!0},iconOnly:{type:Boolean}},setup(e){const r=e,i={good:"text-success",danger:"text-danger",needs:"text-warning",overspend:"text-warning",default:"text-base-lvl-3"},l={overspent:"overspent",available:"available",empty:"empty"},_=V(()=>{var p,c;if(r.category.activity<((p=r.data)==null?void 0:p.amount))return l.available;if(r.category.activity>((c=r.data)==null?void 0:c.amount))return l.overspent}),y=V(()=>{let p=i.default;return _.value==l.available?p=i.good:_.value==l.overspent&&(p=i.overspend),[p]}),n=V(()=>{var p;return r.data&&r.data.target_type.includes("spending")?(p=r.data)==null?void 0:p.amount:0});q({amount:Math.abs(n.value),source_category_id:null,destination_category_id:null});const{openTransactionModal:x}=ue(),b=()=>{x({transactionData:{direction:"WITHDRAW",category_id:r.category.id,total:Math.abs(n.value)}})};return(p,c)=>n.value?(u(),f("span",{key:0,class:M(["flex items-center py-1 cursor-pointer rounded-3xl text-body-1 group",[y.value,e.iconOnly?"px-2":"w-full text-right px-5"]]),onClick:c[0]||(c[0]=K(h=>b(),["stop"])),title:"Execute transaction"},[m(je,{class:"group-hover:text-yellow-500"}),e.iconOnly?k("",!0):(u(),f("span",Fe,A(s(E)(n.value)),1))],2)):k("",!0)}},qe={name:"IcBaselineLocalAtm"},Le={width:"1em",height:"1em",viewBox:"0 0 24 24"},He=d("path",{fill:"currentColor",d:"M11 17h2v-1h1c.55 0 1-.45 1-1v-3c0-.55-.45-1-1-1h-3v-1h4V8h-2V7h-2v1h-1c-.55 0-1 .45-1 1v3c0 .55.45 1 1 1h3v1H9v2h2v1zm9-13H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4V6h16v12z"},null,-1),Pe=[He];function Ke(e,r,i,l,_,y){return u(),f("svg",Le,Pe)}const Re=I(qe,[["render",Ke]]),We={class:"flex px-4 py-2 space-between"},Ze={class:"flex items-center w-full space-x-4"},Qe=d("i",{class:"fa fa-trash"},null,-1),Ge=[Qe],Je={class:"mr-4 cursor-grab"},Xe={class:"items-center font-bold text-body-1"},Ye={class:"flex items-center",title:"Money Assigned"},et={class:"flex items-center space-x-2 text-right flex-nowrap min-w-fit"},tt=d("i",{class:"fa fa-ellipsis-v"},null,-1),at={__name:"BudgetItem",props:{item:{type:Object,required:!0},showDelete:{type:Boolean,required:!1}},emits:["removed","edit"],setup(e,{emit:r}){const i=e,l=w(i.item.budgeted),_=()=>{if(Number(i.item.budgeted)!==Number(l.value)){const t=j(F(x.dates.endDate),"yyyy-MM-dd");S.post(`/budgets/${i.item.id}/months/${t}`,{id:i.item.id,budgeted:Number(l.value)},{preserveState:!0,preserveScroll:!0})}v()},y=[{name:"delete",label:"Delete"},{name:"hide",label:"Hide"},{name:"updateActivity",label:"Update Activity"}],n=()=>{confirm("Are you sure you want to remove this category?")&&S.delete(`budgets/${i.item.id}`,{onSuccess(){r("removed",i.item.id),S.reload({only:["budgets"],preserveScroll:!0})}})},x=Q("pageState",{}),b=()=>{const t=j(F(x.dates.endDate),"yyyy-MM-dd");S.put(`budgets/${i.item.id}/months/${t}`,{onSuccess(){S.reload({only:["budgets"],preserveScroll:!0})}})},p=t=>{switch(t){case"delete":n();break;case"updateActivity":b();break}},c=w(!1),h=w(),v=()=>{c.value=!c.value,c.value&&L(()=>{h.value.focus()})},a=w();return H(()=>{P(a.value)}),(t,o)=>(u(),f("div",We,[d("div",Ze,[e.showDelete?(u(),f("button",{key:0,class:"text-gray-400 transition cursor-pointer hover:text-red-400 focus:outline-none",onClick:o[0]||(o[0]=$=>t.$emit("deleted",$))},Ge)):k("",!0),d("div",Je,[m(J,{class:"handle"})]),d("div",{ref_key:"inputContainer",ref:a},[d("h4",{class:"flex cursor-pointer",onClick:o[2]||(o[2]=$=>t.$emit("open"))},[d("span",Xe,[d("span",{style:oe({color:e.item.color})},A(e.item.name),5),d("i",{class:"ml-2 fa fa-cog",onClick:o[1]||(o[1]=K($=>t.$emit("edit"),["stop"]))})]),e.item.hasOverspent||e.item.hasOverAssigned||e.item.hasUnderFunded?(u(),C(Y,{key:0})):k("",!0)]),d("div",Ye,[m(Re,{class:"text-lg text-success"}),c.value?(u(),C(D,{key:1,modelValue:l.value,"onUpdate:modelValue":o[3]||(o[3]=$=>l.value=$),onBlur:_,"number-format":!0,ref_key:"input",ref:h},null,8,["modelValue"])):(u(),f("span",{key:0,onClick:v,class:"border border-transparent px-4 rounded-md hover:border-slate-400 cursor-pointer py-2.5 inline-block transition hover:text-primary"},A(s(E)(l.value)),1))])],512)]),d("div",et,[m(xe,{value:e.item.available,formatter:s(E),category:e.item},le({_:2},[e.item.available?{name:"suffix",fn:g(()=>[m(ze,{data:e.item.budget,category:e.item,"icon-only":""},null,8,["data","category"])]),key:"0"}:void 0]),1032,["value","formatter","category"]),m(s(X),{trigger:"click",options:y,"key-field":"name","on-select":p},{default:g(()=>[m(z,null,{default:g(()=>[tt]),_:1})]),_:1})])]))}},st={key:0,class:"w-full p-0 m-0"},ot=Z({__name:"BudgetGroupForm",props:{modelValue:{},placeholder:{},mode:{},showCancel:{type:Boolean}},emits:["save","update:model-value"],setup(e,{emit:r}){const{modelValue:i,placeholder:l="New Category group",mode:_="placeholder",showCancel:y=!0}=e,n=w(_=="edit"),x=V(()=>n.value?"Save":"Add Budget Group"),b=()=>{n.value=!1},p=()=>{n.value?(r("save"),L(()=>{l&&(n.value=!1)})):n.value=!0},c=w();return H(()=>{P(c.value)}),(h,v)=>(u(),f("section",{class:"flex px-4 py-2 bg-base-lvl-3",ref_key:"formContainer",ref:c},[n.value?(u(),f("div",st,[m(D,{"model-value":h.modelValue,"onUpdate:modelValue":v[0]||(v[0]=a=>h.$emit("update:model-value",a)),class:"bg-transparent border-none shadow-none",placeholder:h.placeholder},null,8,["model-value","placeholder"])])):k("",!0),d("div",{class:M(["flex",{"w-full justify-center":!n.value}])},[n.value&&h.showCancel?(u(),C(s(N),{key:0,class:"font-bold text-body-1",onClick:b},{default:g(()=>[O(" Cancel ")]),_:1})):k("",!0),m(s(N),{class:M(["justify-center text-center rounded-md",[n.value?"bg-primary min-w-max text-white":"w-full"]]),onClick:p},{default:g(()=>[O(A(x.value),1)]),_:1},8,["class"])],2)],512))}});const lt=I(ot,[["__scopeId","data-v-c4ecaf64"]]),nt={class:"bg-base-lvl-3"},rt={key:0,class:"pt-2"},dt={__name:"BudgetCategories",props:{budgets:{type:Array,required:!0}},setup(e){const r=e,{isSmaller:i}=ce(me),l=i("md"),{budgets:_}=ne(r),{visibleCategories:y,filters:n,setSelectedBudget:x}=pe(_),b=q({account_id:null,parent_id:null,name:"",amount:0}),p=v=>v==null?void 0:v.reduce((a,t)=>(a[t.id]=t,a),{}),c=(v,a)=>{b.processing||$e(b,v,a)},h=v=>{const a=v.map((o,$)=>({id:o.id,name:o.name,index:$})),t=p(a);axios.patch("/api/categories/",{data:t})};return(v,a)=>(u(),f(T,null,[m(lt,{modelValue:s(b).name,"onUpdate:modelValue":a[0]||(a[0]=t=>s(b).name=t),class:M(["rounded-md overflow-hidden",[v.cardShadow]]),onSave:a[1]||(a[1]=t=>c())},null,8,["modelValue","class"]),m(s(W),{class:"w-full space-y-2 dragArea list-group overflow-auto ic-scroller",list:s(y),handle:".handle",onEnd:a[3]||(a[3]=t=>h(s(y)))},{default:g(()=>[(u(!0),f(T,null,R(s(y),t=>(u(),C(Ee,{key:t.id,item:t,"force-expanded":s(n).overspent,class:M([[v.cardShadow],"bg-base-lvl-3"]),"is-mobile":s(l)},{content:g(({isExpanded:o,isAdding:$,toggleAdding:ee})=>[d("div",nt,[$?(u(),f("div",rt,[m(D,{placeholder:"Add subcategory",modelValue:s(b).name,"onUpdate:modelValue":a[2]||(a[2]=B=>s(b).name=B),onKeydown:re(K(B=>c(t.id,ee),["ctrl"]),["enter"])},null,8,["modelValue","onKeydown"])])):k("",!0),o?(u(),C(s(W),{key:1,class:"py-2 space-y-2",list:t.subCategories,handle:".handle",onEnd:B=>h(t.subCategories)},{default:g(()=>[(u(!0),f(T,null,R(t.subCategories,B=>(u(),C(at,{class:"bg-base-lvl-2 border-base-lvl-3",key:`${B.id}-${B.budgeted}`,item:B,"is-mobile":s(l),onOpen:te=>v.router.visit(`/budgets/${B.id}`),onEdit:te=>s(x)(B.id,t.id)},null,8,["item","is-mobile","onOpen","onEdit"]))),128))]),_:2},1032,["list","onEnd"])):k("",!0)])]),_:2},1032,["item","force-expanded","class","is-mobile"]))),128))]),_:1},8,["list"])],64))}},_t=Object.freeze(Object.defineProperty({__proto__:null,default:dt},Symbol.toStringTag,{value:"Module"}));export{_t as B,Y as P,dt as _};
