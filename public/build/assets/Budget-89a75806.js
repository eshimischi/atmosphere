import{D as J,p as b,T as Q,E as X,f as q,o as f,e as N,a as s,w as o,b as t,t as h,c as C,u as e,i as _,G as ee,g as x,n as V,q as z,O as T,A as L,B as P,H as te}from"./app-fc313f38.js";import{Z as j,B as se,L as ae}from"./atmosphere-ui-5b718e83.js";import{N as E,f as oe,b as ne,c as le,d as re}from"./isMobile-3d69cdae.js";import{_ as ie}from"./Modal-ca404241.js";import{_ as de}from"./AppLayout.vue_vue_type_script_setup_true_lang-87835da0.js";import{_ as R}from"./BudgetDetailForm-1be81157.js";import{a as F,u as ue,_ as ce,F as me}from"./useServerSearch-8502c7d2.js";import{f as K,s as H}from"./formatMoney-da670e0a.js";import{_ as pe}from"./LogerButton-370ed8f9.js";import{_ as ge}from"./BudgetProgress-c999bebd.js";import{_ as ve}from"./ExpenseIncome.vue_vue_type_script_setup_true_lang-84653f02.js";import{P as fe,_ as ye}from"./BudgetCategories-b469fe37.js";import{I as W}from"./IconClose-f76962aa.js";import{f as Z}from"./index-3a6f8c36.js";import{u as be}from"./budgetTotals-2f07245c.js";import"./exact-math.node-672740b8.js";import{_ as _e}from"./StatusButtons-37bad538.js";/* empty css                                              */import"./index-975c57c9.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./AppIcon-36bb04e5.js";/* empty css                                                */import"./LogerInput-2f23c230.js";import"./Dropdown-1335b583.js";import"./NumberHider-888bcf03.js";import"./vue-draggable-next.esm-bundler-25f0042a.js";import"./constants-cb26b0c1.js";import"./WidgetCard-97abea05.js";import"./SectionTitle-df81ac17.js";import"./SectionNav-7e8b141c.js";const he={class:"text-lg font-bold"},xe={class:"w-72 md:w-96"},we={class:"flex justify-between text-sm group md:text-base"},$e={class:""},Se={key:0,class:"text-success group-hover:text-white"},Ce={class:"flex items-center justify-end space-x-2"},ke={class:"text-center"},Be={class:"grid grid-cols-2 overflow-hidden divide-x-2"},De=J({__name:"BalanceAssign",props:{value:{type:Number},formatter:{type:Function,default:K},category:{type:Object,required:!0},toAssign:{type:Object,required:!0}},setup(d){const u=d,y={good:"bg-success/80 text-white",danger:"bg-primary text-white",needs:"bg-warning",overspend:"bg-warning",default:"bg-base-lvl-3"},n={overspent:{name:"overspent",description:"You assigned more than you have"},available:{name:"available",description:"To budget"},empty:{name:"empty",description:"All money assigned"}},m=b(()=>u.value>0?n.available.name:u.value<0?n.overspent.name:n.empty.name),D=b(()=>m.value==n.overspent.name),M=b(()=>n[m.value].description),c=b(()=>{let r=y.default;return m.value===n.available.name?r=y.good:m.value===n.overspent.name&&(r=y.danger),[r]}),w=Q({amount:Math.abs(u.value),source_category_id:null,destination_category_id:null}),$=()=>{if(Number(u.value)!==0){const r=oe(H(new Date),"yyyy-MM-dd"),i=m.value==n.available?"source_category_id":"destination_category_id";w.transform(l=>{var O;return{...l,budgeted:Math.abs(u.value),[i]:u.category.id,source_category_id:(O=l.source_category_id)==null?void 0:O.value,type:"movement"}}).post(`/budgets/${u.category.id}/months/${r}`,{onSuccess(){T.reload({preserveScroll:!0})}})}},k=X("categories",q({data:[]})),A=b(()=>{var r;return console.log(k.value.data),(r=k.value.data)==null?void 0:r.map(i=>({value:i.id,key:i.id,label:i.name,type:"group",children:i.subCategories.map(l=>({value:l.id,label:l.name,available:l.available}))}))}),g=q(!1),p=()=>{w.reset(),g.value=!1},U=()=>{g.value=!g.value};return(r,i)=>(f(),N("section",{class:V(["overflow-hidden border divide-y-2 rounded-md cursor-pointer text-body-1",y.default]),onClick:U},[s(e(E),null,{trigger:o(()=>[t("article",{class:V(["flex flex-col items-center justify-center py-4 mx-auto",c.value])},[t("h4",he,h(d.formatter(d.value)),1),t("small",null,h(M.value),1),D.value?(f(),C(e(E),{key:0,trigger:"manual",placement:"bottom","onUpdate:show":r.handleUpdateShow,show:g.value},{trigger:o(()=>[s(e(j),{class:"text-white rounded-md bg-black/30"},{default:o(()=>[_(" Fix this ")]),_:1})]),default:o(()=>[t("div",xe,[s(e(se),{label:"From"},{default:o(()=>[s(e(ee),{modelValue:e(w).source_category_id,"onUpdate:modelValue":i[0]||(i[0]=l=>e(w).source_category_id=l),options:A.value,"group-values":"children","group-label":"label",placeholder:"Type to search","track-by":"value",label:"label","select-label":""},{option:o(({option:l})=>[t("div",we,[t("span",$e,h(l.label||l.$groupLabel),1),l.available?(f(),N("span",Se,h(e(K)(l.available)),1)):x("",!0)])]),_:1},8,["modelValue","options"])]),_:1}),t("div",Ce,[s(e(j),{class:"text-body-1",onClick:p},{default:o(()=>[_("Cancel")]),_:1}),s(e(j),{class:"text-white rounded-md bg-success",onClick:i[1]||(i[1]=l=>$())},{default:o(()=>[_(" Save")]),_:1})])])]),_:1},8,["onUpdate:show","show"])):x("",!0)],2)]),default:o(()=>[t("section",ke,[t("p",null,[_("Inflow: Ready to assign transactions in Month: "),s(F,{value:d.category.activity},null,8,["value"])]),t("p",null,[_("Assigned in month: "),s(F,{value:d.toAssign.budgeted},null,8,["value"])])])]),_:1}),t("article",Be,[t("section",null,[z(r.$slots,"activity")]),t("section",null,[z(r.$slots,"target")])])],2))}}),Me={key:0,class:"border border-primary rounded-md bg-white py-4 px-8"},Ae={class:"flex justify-between"},Oe={class:"text-primary font-bold text-lg"},Te={class:"text-body-1/80"},je={__name:"MessageBox",props:{storageKey:{type:String},title:{type:String},content:{type:String},isClosable:{type:Boolean,default:!0}},setup(d){const u=d,y=ne(u.title||u.storageKey,!0);return(n,m)=>e(y)?(f(),N("article",Me,[t("header",Ae,[t("h4",Oe,h(d.title),1),d.isClosable?(f(),N("button",{key:0,onClick:m[0]||(m[0]=D=>y.value=!1)},[s(W)])):x("",!0)]),t("p",Te,h(d.content),1)])):x("",!0)}};const Ne={class:"flex items-center space-x-2"},Ve={class:"relative"},Fe={class:"text-white text-sm rounded-full group-hover:bg-white/20 p-0.5"},Ue={class:"flex flex-col items-center justify-center w-full py-2"},Ge={class:"font-bold text-secondary"},Ie=t("p",{class:"font-bold text-body-1/80"},"Activity",-1),qe={class:"font-bold"},ze={class:"text-secondary"},Le=t("p",{class:"font-bold text-body-1/80"},"Monthly Goals Progress",-1),Pe={class:"mx-auto mt-8 rounded-lg text-body bg-base max-w-7xl"},Ee={class:"w-full mt-4 space-y-4"},Re={class:"space-y-4"},Ke={class:"mt-4 space-y-4"},$t={__name:"Budget",props:{budgets:{type:Array,required:!0},accounts:{type:Array,default(){return[]}},categories:{type:Array,required:!0},serverSearchOptions:{type:Object,default:()=>({})}},setup(d){const u=d,{serverSearchOptions:y}=L(u),{state:n,executeSearchWithDelay:m}=ue(y,{manual:!0});P("pageState",n);const D=b(()=>`${Z(n.dates.startDate,"MMMM yyyy")}`),{budgets:M}=L(u),{readyToAssign:c,filterGroups:w,filters:$,visibleFilters:k,toggleFilter:A,setSelectedBudget:g,selectedBudget:p}=be(),U=b(()=>p.value?"small":"large"),{isSmaller:r}=le(re),i=r("md"),l={funded:{label:"funded"},underFunded:{label:"Not funded"}},O=b(()=>Object.keys($.value).find(S=>$.value[S]));P("categories",M);const G=S=>{T.delete(route("budgets.destroy",S),{onSuccess:()=>{T.reload(["budgets"])}})},I=()=>{},Y=()=>{n.dates.startDate=H(new Date),m()};return(S,a)=>(f(),C(de,{title:D.value,onBack:a[10]||(a[10]=v=>e(T).visit(S.route("finance"))),"show-back-button":!0},{header:o(()=>[s(ce,null,{actions:o(()=>{var v;return[t("div",Ne,[e(k).overspent?(f(),C(e(j),{key:0,onClick:a[0]||(a[0]=B=>e(A)("overspent")),class:V(["flex items-center justify-between space-x-2 rounded-md min-w-fit group",[e($).overspent?"bg-primary text-white":"text-primary"]])},{default:o(()=>[t("span",Ve,[_(h(e(w).overSpent.length)+" Overspent categories ",1),e($).overspent?x("",!0):(f(),C(fe,{key:0}))]),t("div",Fe,[s(W)])]),_:1},8,["class"])):x("",!0),s(_e,{modelValue:O.value,statuses:l,onChange:e(A)},null,8,["modelValue","onChange"]),s(pe,{variant:"inverse",onClick:Y},{default:o(()=>[_(" Today ")]),_:1}),(v=e(n).dates)!=null&&v.startDate?(f(),C(e(ae),{key:1,class:"w-full h-12 border-none bg-base-lvl-1 text-body",startDate:e(n).dates.startDate,"onUpdate:startDate":a[1]||(a[1]=B=>e(n).dates.startDate=B),endDate:e(n).dates.endDate,"onUpdate:endDate":a[2]||(a[2]=B=>e(n).dates.endDate=B),onChange:a[3]||(a[3]=B=>e(m)()),controlsClass:"bg-transparent text-body hover:bg-base-lvl-1","next-mode":"month"},{default:o(()=>[_(h(e(Z)(e(n).dates.startDate,"MMMM")),1)]),_:1},8,["startDate","endDate"])):x("",!0)])]}),_:1})]),default:o(()=>[s(me,{accounts:d.accounts,"panel-size":U.value},{panel:o(()=>[t("div",Ke,[e(p)&&!e(i)?(f(),C(R,{key:0,class:"mt-5",full:"",category:e(p),item:e(p).budget,onSaved:I,onDeleted:G,onCancel:a[4]||(a[4]=v=>e(g)()),onClose:a[5]||(a[5]=v=>e(g)())},null,8,["category","item"])):x("",!0),s(ve,{value:e(c).inflow+e(c).activity,"footer-stats":[{label:"Income",value:e(c).inflow,class:"text-success"},{label:"Expense",value:e(c).activity,class:"text-error"}]},null,8,["value","footer-stats"])])]),default:o(()=>[s(je,{title:"This is your budget.",content:"Create new category groups and categories and organize them to suit your needs"}),s(De,{class:V(["mt-5 rounded-t-md",[S.cardShadow,!e(k).overspent&&"rounded-b-md"]]),value:e(c).balance,category:e(c).toAssign,"to-assign":e(c)},{activity:o(()=>[t("section",Ue,[t("h4",Ge,[s(F,{value:e(c).activity},null,8,["value"])]),Ie])]),target:o(()=>[s(ge,{class:"w-full text-center h-14",goal:e(c).monthlyGoals.target,current:e(c).monthlyGoals.balance,"progress-class":["bg-secondary/10","bg-secondary/5"]},{default:o(()=>[t("section",qe,[t("h4",ze,[s(F,{value:e(c).monthlyGoals.balance},null,8,["value"])]),Le])]),_:1},8,["goal","current"])]),_:1},8,["class","value","category","to-assign"]),t("section",Pe,[t("article",Ee,[t("section",Re,[s(ye,{budgets:e(M)},null,8,["budgets"])])])])]),_:1},8,["accounts","panel-size"]),s(ie,{show:e(p)&&e(i),"max-width":"mobile",closeable:!0,onClose:a[9]||(a[9]=v=>e(g)())},{default:o(()=>[s(R,{full:"",category:e(p),"onUpdate:category":a[6]||(a[6]=v=>te(p)?p.value=v:null),item:e(p).budget,onSaved:I,onDeleted:G,onCancel:a[7]||(a[7]=v=>e(g)()),onClose:a[8]||(a[8]=v=>e(g)())},null,8,["category","item"])]),_:1},8,["show"])]),_:1},8,["title"]))}};export{$t as default};
