import{r as A,x as G,q as $,f as e,o as v,c as x,a as c,b as m,d as r,K as me,F as Z,h as Q,s as ve,u as H,B as R,a2 as $e,w as Ce,g as E,e as O,i as F,p as ae,t as T,n as N,a6 as I,H as ne,a3 as De,_ as ke,E as se,ae as oe,k as te,af as Ae,m as Se}from"./app.cefd7668.js";import{n as Oe,i as L,g as pe,_ as Be,Z as M,E as Ee}from"./atmosphere-ui.588c294c.js";import{I as ye,u as Fe,_ as Te,V as ge,a as qe}from"./useServerSearch.d123d8c9.js";import{a as Y,_ as Ve}from"./AppLayout.cd77f56f.js";import{aa as Me,ad as Ie,ae as le,af as be,a6 as W,a5 as z,a7 as Ue}from"./index.de789d8e.js";import{g as he,m as _e,W as we,F as re,r as Ne}from"./index.341cb78b.js";import{_ as ie}from"./_plugin-vue_export-helper.cdc0426e.js";import{N as de}from"./Dropdown.49d2a56b.js";import{e as q}from"./exact-math.node.6f837759.js";import{_ as J}from"./LogerInput.bec0734e.js";import{f as j}from"./formatMoney.a91b934f.js";import{_ as je}from"./LogerButton.0789417e.js";import{_ as Le}from"./BudgetProgress.a395309a.js";import{p as Ye}from"./index.557802c7.js";import"./Modal.a2277346.js";/* empty css                                              */import"./SectionTitle.23b660a7.js";import"./ImportResourceModal.ab0a2563.js";import"./SectionNav.d2e4d6cd.js";function ue(n){Me(1,arguments);var t=Ie(n);return t.setDate(1),t.setHours(0,0,0,0),t}function K(n,t){if(t.length<n)throw new TypeError(n+" argument"+(n>1?"s":"")+" required, but only "+t.length+" present")}function X(n){K(1,arguments);var t=Object.prototype.toString.call(n);return n instanceof Date||typeof n=="object"&&t==="[object Date]"?new Date(n.getTime()):typeof n=="number"||t==="[object Number]"?new Date(n):((typeof n=="string"||t==="[object String]")&&typeof console<"u"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://git.io/fjule"),console.warn(new Error().stack)),new Date(NaN))}function fe(n){K(1,arguments);var t=X(n);return t.setHours(0,0,0,0),t}function He(n){K(1,arguments);var t=X(n);return t.setHours(23,59,59,999),t}function We(n){K(1,arguments);var t=X(n),a=t.getMonth();return t.setFullYear(t.getFullYear(),a+1,0),t.setHours(23,59,59,999),t}function Ge(n){K(1,arguments);var t=X(n);return He(t).getTime()===We(t).getTime()}const ce=n=>{const t=A(n.nextMode),a=o=>{const f=new Date(o.setDate(o.getDate()-4)),p=[];for(let _=0;_<7;_++)f.setDate(f.getDate()+1),p.push(fe(new Date(f)));return p},s=A(0),l=A(),i=o=>{l.value=o||l.value},u=o=>{const f=new Date(o.setDate(o.getDate()-o.getDay()+s.value)),p=[new Date(f)];for(;f.setDate(f.getDate()+1)&&f.getDay()!==s.value;){const _=new Date(new Date(f).setHours(0,0,0,0));p.push(_)}return p},C=o=>{const f=new Date(o.setDate(o.getDate()-(o.getDate()-1))),p=[new Date(f)];for(;!Ge(f);)f.setDate(f.getDate()+1),p.push(new Date(f));return p},h=o=>{const f={day:a,week:u,month:C},p=t.value||"week";return f[p](new Date(o))},d=A(),w=o=>{d.value=fe(o||d.value)};w(n.initialDate||new Date);const b=()=>{i(h(d.value))};G(d,(o,f)=>{b()},{immediate:!0}),G(t,b);const y=()=>{const o=t.value==="day"?3:l.value.length-1,f=e(l),p=new Date(f[o].setDate(f[o].getDate()+1));w(p)},g=()=>{const o=t.value==="day"?3:0,f=e(l),p=new Date(f[o].setDate(f[o].getDate()-1));w(p)};return{selectedDay:d,selectedSpan:l,startDate:$(()=>l.value[0]),endDate:$(()=>l.value[l.value.length-1]),controls:{setDateSpan:i,setDay:w,previous:g,next:y}}},ze={class:"grid grid-cols-5 gap-1"},Ke=["onClick"],Pe={__name:"ColorSelector",props:{modelValue:{type:String}},setup(n){const t=n,a=["#037F4C","#00C875","#9CD326","#CAB641","#FFCB00","#784BD1","#A25DDC","#0086C0","#579BFC","#66CCFF","#BB3354","#E2445C","#FF158A","#FF5AC4","#FF642E","#7F5347","#C4C4C4","#808080"],s=$(()=>t.modelValue||a[0]);return(l,i)=>(v(),x("div",null,[c(e(le),{trigger:"click"},{trigger:m(()=>[r("div",{class:"w-4 h-4 rounded-sm cursor-pointer",style:me({backgroundColor:e(s)})},null,4)]),default:m(()=>[r("div",ze,[(v(),x(Z,null,Q(a,u=>r("div",{class:"w-4 h-4 border border-transparent rounded-sm cursor-pointer hover:border-slate-400",style:me({backgroundColor:u}),key:u,onClick:C=>l.$emit("update:modelValue",u)},null,12,Ke)),64))])]),_:1})]))}},Re={name:"IcBaselineOutlinedFlag"},Ze={width:"1em",height:"1em",viewBox:"0 0 24 24"},Qe=r("path",{fill:"currentColor",d:"m14 6l-1-2H5v17h2v-7h5l1 2h7V6h-6zm4 8h-4l-1-2H7V6h5l1 2h5v6z"},null,-1),Je=[Qe];function Xe(n,t,a,s,l,i){return v(),x("svg",Ze,Je)}const et=ie(Re,[["render",Xe]]),tt={class:"text-left border-b rounded-md bg-base-lvl-3 pb-4"},at={class:"mr-2"},nt=F(" Set target "),st={key:1},ot=r("span",{class:"flex items-center pl-2"}," RD$ ",-1),lt=r("i",{class:"fa fa-ellipsis-v"},null,-1),rt={key:0},it={class:"flex mt-2 space-x-2"},dt={class:"flex justify-between mt-4"},ut={class:"flex font-bold"},ct=F(" Cancel "),mt=F(" Save "),gt={__name:"BudgetTargetForm",props:{parentId:{type:Number,default:null},full:{type:Boolean,default:!1},category:{type:Object,required:!0},item:{type:Object,default:()=>{}}},emits:["cancel","deleted"],setup(n,{emit:t}){const a=n,s=ve({form:H({category_id:null,parent_id:null,color:he(),name:a.category.name,amount:0,assigned:0,target_type:"",frequency:"MONTHLY",frequency_month_date:null,frequency_week_day:null,frequency_date:null,frequency_interval:0,frequency_interval_unit:0}),targetTypes:[{value:"spending",label:"Spending",description:`For groceries, holidays, vacations
                Fund up to an amount with the ability to spend from it along the way
                `},{value:"saving_balance",label:"Saving Balance",description:`down payments, emergency fund
                Save this amount over time and maintain the balance by replenishing any money spent
                `},{value:"savings_monthly",label:"Savings Monthly",description:`For saving goals with unknown targets
                Contribute this amount every month until you disable this target
                `},{value:"debt_monthly_payment",label:"Debt Monthly Payment",description:`Use for: Mortgage, student loans, auto loans, etc
                Budget for payments until you are debt free
                `}],frequencies:[{value:"MONTHLY",label:"Monthly"},{value:"WEEKLY",label:"Weekly"},{value:"DATE",label:"By Date"}],isActive:Boolean(a.item)}),l=$(()=>({...{MONTHLY:{field:"frequency_month_date",options:_e()},WEEKLY:{field:"frequency_week_day",options:be(we)}}[s.form.frequency]}));G(()=>a.category,()=>{a.item?(s.form.reset(),Object.keys(s.form.data()).forEach(p=>{s.form[p]=a.item[p]||""}),s.isActive=!0):(s.isActive=!1,s.form.reset())},{deep:!0,immediate:!0});const i=()=>{var V,S;const _={update:{method:"put",url:((V=a.item)==null?void 0:V.id)&&`/budgets/${a.category.id}/targets/${a.item.id}`},save:{method:"post",url:`/budgets/${a.category.id}/targets`}}[(S=a.item)!=null&&S.id?"update":"save"];s.form.transform(B=>({...B,parent_id:B.parent_id||s.parentId}))[_.method](_.url,{preserveScroll:!0})},u=()=>{a.item?t("cancel"):s.isActive=!1},{selectedSpan:C}=ce({nextMode:"month"}),h=$(()=>s.form.frequency==re.WEEKLY&&C.value.filter(p=>{var _,V;return W(p,"iiiiii").toLowerCase()==((V=(_=s.form)==null?void 0:_.frequency_week_day)==null?void 0:V.toLowerCase())})),{form:d,targetTypes:w,frequencies:b}=R(s),y=[{name:"setAssigned",label:"Set Assigned"},{name:"setAvailable",label:"Set Available"},{name:"clear",label:"Clear"}],g=p=>{s.form.amount=p},o=()=>{d.value.amount=0},f=p=>{switch(p){case"setAssigned":g(a.category.budgeted);break;case"setAvailable":console.log(a.category),g(a.category.available);break;default:o();break}};return(p,_)=>{const V=$e("auto-animate");return Ce((v(),x("section",tt,[s.isActive?(v(),x("div",st,[c(e(L),{label:"Target Type"},{default:m(()=>[c(e(z),{filterable:"",clearable:"",size:"large",value:e(d).target_type,"onUpdate:value":_[1]||(_[1]=S=>e(d).target_type=S),"default-expand-all":!0,options:s.targetTypes},null,8,["value","options"]),p.errors?(v(),E(e(Oe),{key:0,errors:p.errors,field:"account_id"},null,8,["errors"])):O("",!0)]),_:1}),c(e(L),{label:"Amount",errors:"errors",field:"amount"},{default:m(()=>[c(e(pe),{"number-format":!0,modelValue:e(d).amount,"onUpdate:modelValue":_[2]||(_[2]=S=>e(d).amount=S)},{prefix:m(()=>[ot]),suffix:m(()=>[c(e(de),{trigger:"click",options:y,"key-field":"name","on-select":f},{default:m(()=>[c(Y,null,{default:m(()=>[lt]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(d).target_type=="spending"?(v(),x("section",rt,[c(e(Be),{modelValue:e(d).frequency,"onUpdate:modelValue":_[3]||(_[3]=S=>e(d).frequency=S),options:s.frequencies,class:"text-sm","selected-class":"text-white bg-primary"},null,8,["modelValue","options"]),["MONTHLY","WEEKLY"].includes(e(d).frequency)?(v(),E(e(L),{key:0,label:"Every",errors:p.errors,field:e(l).field},{default:m(()=>[c(e(z),{filterable:"",clearable:"",size:"large",value:e(d)[e(l).field],"onUpdate:value":_[4]||(_[4]=S=>e(d)[e(l).field]=S),"default-expand-all":!0,options:e(l).options},null,8,["value","options"]),r("div",it,[(v(!0),x(Z,null,Q(e(h),S=>(v(),x("div",{class:"w-full h-2 bg-primary",key:S}))),128))])]),_:1},8,["errors","field"])):O("",!0)])):O("",!0),r("div",dt,[r("div",ut,[c(e(M),{class:"block h-full text-gray-500",onClick:u},{default:m(()=>[ct]),_:1})]),c(e(M),{class:"block h-full text-white rounded-md bg-primary",onClick:_[5]||(_[5]=S=>i())},{default:m(()=>[mt]),_:1})])])):(v(),E(Y,{key:0,onClick:_[0]||(_[0]=S=>s.isActive=!0),class:"bg-body-1/5 py-2 px-2 rounded-md text-body-1 w-full flex items-center"},{default:m(()=>[r("span",at,[c(et)]),nt]),_:1}))])),[[V]])}}},ft={class:"w-full text-right"},vt={class:"flex space-x-2 justify-end items-center"},pt=F("Cancel"),yt=F(" Save"),bt={__name:"BalanceInput",props:{value:{type:Number},formatter:{type:Function,default(){return n=>n}},category:{type:Object,required:!0}},setup(n){const t=n,a={good:"bg-success",danger:"bg-danger",needs:"bg-warning",overspend:"bg-warning",default:"bg-base-lvl-3"},s={overspent:"overspent",available:"available",empty:"empty"},l=$(()=>{if(t.value>0)return s.available;if(t.value<0)return s.overspent}),i=$(()=>{let y=a.default;return t.value>0?y=a.good:t.value<0&&(y=a.overspend),[y]}),u=H({amount:Math.abs(t.value),source_category_id:null,destination_category_id:null}),C=()=>{{const y=W(ue(new Date),"yyyy-MM-dd"),g=l.value==s.available?"source_category_id":"destination_category_id";u.transform(o=>({...o,budgeted:o.amount,[g]:t.category.id,type:"movement"})).post(`/budgets/${t.category.id}/months/${y}`,{preserveState:!0,preserveScroll:!0})}},h=ae("categoryOptions",[]),d=A(!1),w=()=>{u.reset(),d.value=!1},b=()=>{d.value=!d.value};return(y,g)=>(v(),x("div",ft,[c(e(le),{trigger:"manual",placement:"bottom","onUpdate:show":y.handleUpdateShow,show:d.value},{trigger:m(()=>[r("span",{class:N(["px-5 py-1 inline-block cursor-pointer rounded-3xl text-body-1 min-w-max",e(i)]),onClick:b},T(n.formatter(n.value)),3)]),default:m(()=>[r("div",null,[c(e(L),{label:"Move"},{default:m(()=>[c(J,{modelValue:e(u).amount,"onUpdate:modelValue":g[0]||(g[0]=o=>e(u).amount=o)},null,8,["modelValue"])]),_:1}),e(l)==s.available?(v(),E(e(L),{key:0,label:"To"},{default:m(()=>[c(e(z),{filterable:"",clearable:"",size:"large",value:e(u).destination_category_id,"onUpdate:value":g[1]||(g[1]=o=>e(u).destination_category_id=o),"default-expand-all":!0,options:e(h)},null,8,["value","options"])]),_:1})):(v(),E(e(L),{key:1,label:"From"},{default:m(()=>[c(e(z),{filterable:"",clearable:"",size:"large",value:e(u).source_category_id,"onUpdate:value":g[2]||(g[2]=o=>e(u).source_category_id=o),"default-expand-all":!0,options:e(h)},null,8,["value","options"])]),_:1})),r("div",vt,[c(e(M),{class:"text-body-1",onClick:w},{default:m(()=>[pt]),_:1}),c(e(M),{class:"bg-success text-white rounded-md",onClick:g[3]||(g[3]=o=>C())},{default:m(()=>[yt]),_:1})])])]),_:1},8,["onUpdate:show","show"])]))}},ht=(n,t=null,a)=>{n.transform(s=>({...s,resource_type:"transactions",parent_id:t})).post("/budgets",{onSuccess(){I.Inertia.reload({preserveScroll:!0}),n.reset(),ne(()=>{a&&a()})}})},_t=n=>{const t=A([]),a=A([]),s=$(()=>(t.value=[],a.value=[],De.exports.cloneDeep(n.value).data.map(y=>{const g=xt(y.subCategories,{onOverspent(o){t.value.push(o)},onOverAssigned(o){a.value.push(o)}});return{...y,...g}}))),l=A(!1),i=A([]);G(()=>n.value,()=>{i.value=C()},{immediate:!0,deep:!0});const u=()=>{l.value=!l.value,i.value=C()};function C(){return s.value.reduce((b,y)=>{var o;let g=y.name!="Inflow";return l.value&&(g=g&&y.hasOverspent),g&&(y.subCategories=(o=y.subCategories)==null?void 0:o.filter(f=>l.value?f.hasOverspent:!0),b.push(y)),b},[])}const h=$(()=>s.value.find(b=>b.name=="Inflow")),d=$(()=>s.value.filter(b=>b.name!="Inflow"));return{readyToAssign:$(()=>{var o,f,p,_;const b=$t(d.value);console.log(((o=h.value)==null?void 0:o.activity)|0,b.budgeted||0,"Balance");const y=q.sub(((f=h.value)==null?void 0:f.activity)|0,b.budgeted||0),g=(_=(p=h.value)==null?void 0:p.subCategories[0])!=null?_:{};return{balance:y,...g,...b}}),budgetState:d,visibleCategories:i,overspentCategories:t,overspentFilter:l,toggleOverspent:u}},wt=n=>n.target_type=="spending",xt=(n,t={onOverspent:()=>{},onOverAssigned:()=>{},onUnderfunded:()=>{}})=>Object.values(n).reduce((a,s)=>{const{budget:l}=s;if(a.budgeted=q.add(a.budgeted,s.budgeted||0),a.activity=q.add(a.activity,s.activity||0),a.available=q.add(a.available,s.available||0),Number(s.available)<0&&s.name!=="Inflow"&&(t.onOverspent(s),s.budgeted,a.hasOverspent=!0),l&&wt(l)&&l.amount){const i=Ct(l,l.month),u=q.mul(l.amount,i);parseFloat(s.budgeted)>u?(t.onOverAssigned(s),a.hasOverAssigned=!0,s.hasOverAssigned=!0):parseFloat(s.budgeted)<u&&(s.hasUnderfunded=!0,t.onUnderfunded&&t.onUnderfunded(s)),a.monthlyGoals.target=q.add(a.monthlyGoals.target,u),a.monthlyGoals.balance=q.add(a.monthlyGoals.balance,s.budgeted)}return a},{budgeted:0,activity:0,available:0,monthlyGoals:{target:0,balance:0}}),$t=n=>n.reduce((t,a)=>(t.budgeted=q.add(a.budgeted,t.budgeted||0),t.activity=q.add(a.activity,t.activity||0),t.monthlyGoals.target=q.add(t.monthlyGoals.target,a.monthlyGoals.target),t.monthlyGoals.balance=q.add(t.monthlyGoals.balance,a.monthlyGoals.balance),t),{budgeted:0,activity:0,monthlyGoals:{target:0,balance:0}}),Ct=(n,t)=>{try{const a=typeof t=="string"?Ye(t):t,{selectedSpan:s}=ce({nextMode:"month",initialDate:a});return n.frequency==re.WEEKLY?s.value.filter(l=>{var i;return W(l,"iiiiii").toLowerCase()==((i=n.frequency_week_day)==null?void 0:i.toLowerCase())}).length:1}catch{return 1}},Dt={class:"flex items-center justify-between mt-2 mb-2"},kt={class:"px-1 flex items-center justify-center"},At=r("div",null," Auto-Assign ",-1),St=r("div",null," Available Balance ",-1),Ot=r("div",null," Notes ",-1),Bt={__name:"BudgetDetailForm",props:{parentId:{type:Number,default:null},full:{type:Boolean,default:!1},category:{type:Object,required:!0},item:{type:Object,default:()=>{}}},setup(n){const t=n,a=H({category_id:null,parent_id:null,color:he(),name:t.category.name,amount:0,assigned:0,target_type:"",frequency:"MONTHLY",frequency_month_date:null,frequency_week_day:null,frequency_date:null,frequency_interval:0,frequency_interval_unit:0});$(()=>({...{MONTHLY:{field:"frequency_month_date",options:_e()},WEEKLY:{field:"frequency_week_day",options:be(we)}}[Ne]})),G(()=>t.item,l=>{l?(a.reset(),Object.keys(a.data()).forEach(i=>{a[i]=l[i]||a[i]})):a.reset()},{deep:!0,immediate:!0});const{selectedSpan:s}=ce({nextMode:"month"});return $(()=>a.frequency==re.WEEKLY&&s.value.filter(l=>{var i,u;return W(l,"iiiiii").toLowerCase()==((u=(i=state.form)==null?void 0:i.frequency_week_day)==null?void 0:u.toLowerCase())})),(l,i)=>(v(),x("section",{class:N(["px-5 pt-2 text-left border-b rounded-md space-y-4 shadow-xl bg-base-lvl-3 pb-4",{flex:!n.full}])},[r("header",Dt,[c(e(pe),{modelValue:n.category.name,"onUpdate:modelValue":i[1]||(i[1]=u=>n.category.name=u),class:"border-transparent cursor-pointer hover:text-primary hover:border-primary",rounded:""},{prefix:m(()=>[r("div",kt,[c(Pe,{modelValue:e(a).color,"onUpdate:modelValue":i[0]||(i[0]=u=>e(a).color=u)},null,8,["modelValue"])])]),_:1},8,["modelValue"])]),c(gt,{"parent-id":n.parentId,category:n.category,item:n.item,onDelete:i[2]||(i[2]=u=>l.$emit("delete"))},null,8,["parent-id","category","item"]),At,St,Ot],2))}},Et={class:"flex justify-between py-2 px-4 text-body-1/80"},Ft={class:"flex items-center space-x-2"},Tt={class:"cursor-grab"},qt={class:"flex items-center"},Vt={class:"relative font-bold"},Mt={key:0,class:"absolute -top-1 -right-2 h-2 w-2 bg-error rounded-full ring ring-error/20 animate-pulse"},It={class:"flex items-center space-x-2"},Ut=r("i",{class:"fa fa-plus"},null,-1),Nt=r("i",{class:"fa fa-ellipsis-v"},null,-1),jt={__name:"BudgetGroupItem",props:{item:{type:Object,required:!0},forceExpanded:{type:Boolean,default:!1}},emits:["removed"],setup(n,{emit:t}){const a=n,s=A(a.forceExpanded),l=$(()=>s.value?"fa-chevron-up":"fa-chevron-down");ke(()=>{a.forceExpanded&&(s.value=!0)});const i=A(!1),u=()=>i.value=!i.value,C=A();se(()=>{oe(C.value)});const h=[{name:"delete",label:"Delete"}],d=()=>{confirm("Are you sure you want to remove this category group?")&&I.Inertia.delete(`budgets/${a.item.id}`,{onSuccess(){t("removed",a.item.id),I.Inertia.reload({only:["budgets"],preserveScroll:!0})}})},w=b=>{switch(b){case"delete":d();break}};return(b,y)=>(v(),x("article",null,[r("header",Et,[r("div",Ft,[r("div",Tt,[c(ye,{class:"handle"})]),c(Y,{onClick:y[0]||(y[0]=g=>s.value=!s.value)},{default:m(()=>[r("i",{class:N(["fa",e(l)])},null,2)]),_:1}),r("div",qt,[r("h4",Vt,[F(T(n.item.name)+" ",1),n.item.hasOverspent||n.item.hasOverAssigned||n.item.hasUnderfunded?(v(),x("div",Mt)):O("",!0)])])]),r("div",It,[r("p",null,T(e(j)(n.item.activity))+" of "+T(e(j)(n.item.budgeted)),1),c(Y,{onClick:u},{default:m(()=>[Ut]),_:1}),c(e(de),{trigger:"click",options:h,"key-field":"name","on-select":w},{default:m(()=>[c(Y,null,{default:m(()=>[Nt]),_:1})]),_:1})])]),r("section",{class:"pl-4 border-l-4 border-primary bg-base-lvl-3",ref_key:"dropdown",ref:C},[s.value||i.value?te(b.$slots,"content",{key:0,isExpanded:s.value,toggleAdding:u,isAdding:i.value}):O("",!0)],512)]))}},Lt={name:"IcBaselineBolt"},Yt={width:"1em",height:"1em",viewBox:"0 0 24 24"},Ht=r("path",{fill:"currentColor",d:"M11 21h-1l1-7H7.5c-.58 0-.57-.32-.38-.66c.19-.34.05-.08.07-.12C8.48 10.94 10.42 7.54 13 3h1l-1 7h3.5c.49 0 .56.33.47.51l-.07.15C12.96 17.55 11 21 11 21z"},null,-1),Wt=[Ht];function Gt(n,t,a,s,l,i){return v(),x("svg",Yt,Wt)}const zt=ie(Lt,[["render",Gt]]),Kt={__name:"BudgetTransaction",props:{data:{type:Object},formatter:{type:Function,default(){return n=>n}},category:{type:Object,required:!0}},setup(n){const t=n,a={good:"text-success",danger:"text-danger",needs:"text-warning",overspend:"text-warning",default:"text-base-lvl-3"},s={overspent:"overspent",available:"available",empty:"empty"},l=$(()=>{var d,w;if(t.category.activity<((d=t.data)==null?void 0:d.amount))return s.available;if(t.category.activity>((w=t.data)==null?void 0:w.amount))return s.overspent}),i=$(()=>{let d=a.default;return l.value==s.available?d=a.good:l.value==s.overspent&&(d=a.overspend),[d]}),u=$(()=>{var d;return t.data&&t.data.target_type.includes("spending")?(d=t.data)==null?void 0:d.amount:0});H({amount:Math.abs(u.value),source_category_id:null,destination_category_id:null});const{openTransferModal:C}=Ue(),h=()=>{C({transactionData:{date:new Date,direction:"WITHDRAW",category_id:t.category.id,total:Math.abs(u.value)}})};return ae("accountsOptions",[]),(d,w)=>(v(),x("div",{class:"w-full text-right",onClick:w[1]||(w[1]=b=>h())},[e(u)?(v(),x("span",{key:0,class:N(["px-5 py-1 cursor-pointer rounded-3xl text-body-1 flex items-center group",e(i)]),onClick:w[0]||(w[0]=(...b)=>d.toggle&&d.toggle(...b)),title:"Execute transaction"},[c(zt,{class:"group-hover:text-yellow-500"}),F(" "+T(e(j)(e(u))),1)],2)):O("",!0)]))}},Pt={class:"flex px-4 py-2 space-between"},Rt={class:"flex items-center w-full space-x-4"},Zt=r("i",{class:"fa fa-trash"},null,-1),Qt=[Zt],Jt={class:"mr-4 cursor-grab"},Xt={key:0,class:"absolute -top-1 -right-2 h-2 w-2 bg-error rounded-full ring ring-error/20 animate-pulse"},ea={class:"flex items-center space-x-2 text-right flex-nowrap min-w-fit"},ta=r("i",{class:"fa fa-ellipsis-v"},null,-1),aa={__name:"BudgetItem",props:{item:{type:Object,required:!0},showDelete:{type:Boolean,required:!1}},emits:["removed"],setup(n,{emit:t}){const a=n,s=A(a.item.budgeted),l=()=>{if(Number(a.item.budgeted)!==Number(s.value)){const y=W(ue(new Date),"yyyy-MM-dd");I.Inertia.post(`/budgets/${a.item.id}/months/${y}`,{id:a.item.id,budgeted:Number(s.value)},{preserveState:!0,preserveScroll:!0})}w()},i=[{name:"delete",label:"Delete"},{name:"hide",label:"Hide"}],u=()=>{confirm("Are you sure you want to remove this category?")&&I.Inertia.delete(`budgets/${a.item.id}`,{onSuccess(){t("removed",a.item.id),I.Inertia.reload({only:["budgets"],preserveScroll:!0})}})},C=y=>{switch(y){case"delete":u();break}},h=A(!1),d=A(),w=()=>{h.value=!h.value,h.value&&ne(()=>{d.value.focus()})},b=A();return se(()=>{oe(b.value)}),(y,g)=>(v(),x("div",Pt,[r("div",Rt,[n.showDelete?(v(),x("button",{key:0,class:"text-gray-400 transition cursor-pointer hover:text-red-400 focus:outline-none",onClick:g[0]||(g[0]=o=>y.$emit("deleted",o))},Qt)):O("",!0),r("div",Jt,[c(ye,{class:"handle"})]),r("div",{ref_key:"inputContainer",ref:b},[r("h4",{class:"cursor-pointer",onClick:g[1]||(g[1]=o=>y.$emit("edit"))},[F(T(n.item.name)+" ",1),n.item.hasOverspent||n.item.hasOverAssigned||n.item.hasUnderfunded?(v(),x("div",Xt)):O("",!0)]),h.value?(v(),E(J,{key:1,modelValue:s.value,"onUpdate:modelValue":g[2]||(g[2]=o=>s.value=o),onBlur:l,"number-format":!0,ref_key:"input",ref:d},null,8,["modelValue"])):(v(),x("span",{key:0,onClick:w,class:"border border-transparent px-4 rounded-md hover:border-slate-400 cursor-pointer py-2.5 inline-block transition hover:text-primary"},T(e(j)(s.value)),1))],512)]),r("div",ea,[c(bt,{value:n.item.available,formatter:e(j),category:n.item},null,8,["value","formatter","category"]),n.item.available?(v(),E(Kt,{key:0,data:n.item.budget,category:n.item},null,8,["data","category"])):O("",!0),c(e(de),{trigger:"click",options:i,"key-field":"name","on-select":C},{default:m(()=>[c(Y,null,{default:m(()=>[ta]),_:1})]),_:1})])]))}};const na={key:0,class:"w-full m-0 p-0"},sa=F(" Cancel "),oa={__name:"BudgetGroupForm",props:{modelValue:{type:String}},emits:["save"],setup(n,{emit:t}){const a=A(!1),s=$(()=>a.value?"Save":"Add Budget Group"),l=()=>{a.value=!1},i=()=>{a.value?(t("save"),ne(()=>{a.value=!1})):a.value=!0},u=A();return se(()=>{oe(u.value)}),(C,h)=>(v(),x("section",{class:"flex bg-base-lvl-3 py-2 px-4",ref_key:"formContainer",ref:u},[a.value?(v(),x("div",na,[c(J,{value:n.modelValue,"onUpdate:modelValue":h[0]||(h[0]=d=>C.$emit("update:modelValue",d)),class:"bg-transparent border-none shadow-none",placeholder:"New Category group"},null,8,["value"])])):O("",!0),r("div",{class:N(["flex",{"w-full justify-center":!a.value}])},[a.value?(v(),E(e(M),{key:0,class:"text-body-1 font-bold",onClick:l},{default:m(()=>[sa]),_:1})):O("",!0),c(e(M),{class:N(["justify-center text-center rounded-md",[a.value?"bg-primary min-w-max text-white":"w-full"]]),onClick:i},{default:m(()=>[F(T(e(s)),1)]),_:1},8,["class"])],2)],512))}},la=ie(oa,[["__scopeId","data-v-188011b4"]]),ra={class:"py-4 flex flex-col justify-center items-center mx-auto"},ia={class:"text-lg font-bold"},da=F(" Fix this "),ua={class:"flex space-x-2 justify-end items-center"},ca=F("Cancel"),ma=F(" Save"),ga={class:"grid grid-cols-2 divide-x-2 overflow-hidden"},fa={__name:"BalanceAssign",props:{value:{type:Number},formatter:{type:Function,default:j},category:{type:Object,required:!0}},setup(n){const t=n,a={good:"bg-success",danger:"bg-error/50",needs:"bg-warning",overspend:"bg-warning",default:"bg-base-lvl-3"},s={overspent:{name:"overspent",description:"You assigned more than you have"},available:{name:"available",description:"To budget"},empty:{name:"empty",description:"All money assigned"}},l=$(()=>t.value>0?s.available.name:t.value<0?s.overspent.name:s.empty.name),i=$(()=>l.value==s.overspent.name),u=$(()=>s[l.value].description),C=$(()=>{let o=a.default;return l.value===s.available?o=a.good:l.value===s.overspent&&(o=a.danger),[o]}),h=H({amount:Math.abs(t.value),source_category_id:null,destination_category_id:null}),d=()=>{if(Number(t.value)!==0){const o=W(ue(new Date),"yyyy-MM-dd"),f=l.value==s.available?"source_category_id":"destination_category_id";h.transform(p=>({...p,budgeted:Math.abs(t.value),[f]:t.category.id,type:"movement"})).post(`/budgets/${t.category.id}/months/${o}`,{onSuccess(){I.Inertia.reload({preserveScroll:!0})}})}},w=ae("categoryOptions",[]),b=A(!1),y=()=>{h.reset(),b.value=!1},g=()=>{b.value=!b.value};return(o,f)=>(v(),x("section",{class:N(["cursor-pointer text-body-1 divide-y-2",e(C)]),onClick:g},[r("article",ra,[r("h4",ia,T(n.formatter(n.value)),1),r("small",null,T(e(u)),1),e(i)?(v(),E(e(le),{key:0,trigger:"manual",placement:"bottom","onUpdate:show":o.handleUpdateShow,show:b.value},{trigger:m(()=>[c(e(M),{class:"rounded-md bg-white/80"},{default:m(()=>[da]),_:1})]),default:m(()=>[r("div",null,[c(e(L),{label:"From"},{default:m(()=>[c(e(z),{filterable:"",clearable:"",size:"large",value:e(h).source_category_id,"onUpdate:value":f[0]||(f[0]=p=>e(h).source_category_id=p),"default-expand-all":!0,options:e(w)},null,8,["value","options"])]),_:1}),r("div",ua,[c(e(M),{class:"text-body-1",onClick:y},{default:m(()=>[ca]),_:1}),c(e(M),{class:"bg-success text-white rounded-md",onClick:f[1]||(f[1]=p=>d())},{default:m(()=>[ma]),_:1})])])]),_:1},8,["onUpdate:show","show"])):O("",!0)]),r("article",ga,[r("section",null,[te(o.$slots,"activity")]),r("section",null,[te(o.$slots,"target")])])],2))}},va={class:"flex items-center space-x-2"},pa=F("Import Budget"),ya={class:"w-full flex-col justify-center py-2 flex items-center"},ba=r("p",{class:"font-bold"},"Activity",-1),ha=r("p",{class:"font-bold"},"Monthly Goals Progress",-1),_a={class:"mx-auto mt-8 rounded-lg text-body bg-base max-w-7xl"},wa={class:"bg-base-lvl-3"},xa={key:0,class:"pt-2"},Ha={__name:"Budget",props:{budgets:{type:Array,required:!0},accounts:{type:Array,default(){return[]}},categories:{type:Array,required:!0},serverSearchOptions:{type:Object,default:()=>({})}},setup(n){const t=n,{serverSearchOptions:a}=R(t),{state:s}=Fe(a),{budgets:l}=R(t),{readyToAssign:i,visibleCategories:u,overspentCategories:C,toggleOverspent:h,overspentFilter:d}=_t(l),w=$(()=>d.value||C.value.length>0),b=ve({isModalOpen:!1,isAddingGroup:!0,selectedBudget:null,budgetTotal:$(()=>0),categoryForm:H({account_id:null,parent_id:null,name:"",amount:0})}),{categoryForm:y,selectedBudget:g}=R(b),o=B=>B==null?void 0:B.reduce((D,k)=>(D[k.id]=k,D),{}),f=B=>{I.Inertia.delete(route("budgets.destroy",B),{onSuccess:()=>{I.Inertia.reload(["budgets"])}})},p=()=>{},_=(B,D)=>{y.value.processing||ht(b.categoryForm,B,D)},V=B=>{const D=B.map((P,ee)=>({id:P.id,name:P.name,index:ee})),k=o(D);axios.patch("/api/categories/",{data:k})},S=$(()=>g.value?"large":"small");return(B,D)=>(v(),E(Ve,{title:"Budget Settings",onBack:D[7]||(D[7]=k=>B.$inertia.visit(B.route("finance"))),"show-back-button":!0},{header:m(()=>[c(Te,null,{actions:m(()=>[r("div",va,[e(w)?(v(),E(e(M),{key:0,onClick:e(h),class:"bg-primary/40 items-center min-w-fit rounded-md space-x-2 flex justify-between text-white flex"},{default:m(()=>[r("span",null," View "+T(e(C).length)+" overspent categories ",1)]),_:1},8,["onClick"])):O("",!0),c(e(Ee),{class:"w-full h-12 border-none bg-base-lvl-1 text-body",startDate:e(s).dates.startDate,"onUpdate:startDate":D[0]||(D[0]=k=>e(s).dates.startDate=k),endDate:e(s).dates.endDate,"onUpdate:endDate":D[1]||(D[1]=k=>e(s).dates.endDate=k),controlsClass:"bg-transparent text-body hover:bg-base-lvl-1","next-mode":"month"},null,8,["startDate","endDate"]),c(je,{variant:"inverse"},{default:m(()=>[pa]),_:1})])]),_:1})]),default:m(()=>[c(qe,{accounts:n.accounts,"panel-size":e(S)},{panel:m(()=>[e(g)?(v(),E(Bt,{key:0,class:"mt-5 mr-4",full:"",category:e(g),item:e(g).budget,onSaved:p,onDeleted:f,onCancel:D[6]||(D[6]=k=>g.value=null)},null,8,["category","item"])):O("",!0)]),default:m(()=>[c(fa,{class:N(["rounded-t-md mt-5",{"rounded-b-md shadow-md":!e(w)}]),value:e(i).balance,category:e(i)},{activity:m(()=>[r("section",ya,[r("h4",null,T(e(j)(e(i).activity)),1),ba])]),target:m(()=>[c(Le,{class:"w-full text-center h-14",goal:e(i).monthlyGoals.target,current:e(i).monthlyGoals.balance,"progress-class":["bg-body-1/5","bg-body-1/5"]},{default:m(()=>[r("section",null,[r("h4",null,T(e(j)(e(i).monthlyGoals.balance)),1),ha])]),_:1},8,["goal","current"])]),_:1},8,["class","value","category"]),r("div",_a,[c(la,{modelValue:e(y).name,"onUpdate:modelValue":D[2]||(D[2]=k=>e(y).name=k),class:"shadow-md rounded-md overflow-hidden",onSave:D[3]||(D[3]=k=>_())},null,8,["modelValue"]),c(e(ge),{class:"w-full mt-4 space-y-2 dragArea list-group",list:e(u),handle:".handle",onEnd:D[5]||(D[5]=k=>V(e(u)))},{default:m(()=>[(v(!0),x(Z,null,Q(e(u),k=>(v(),E(jt,{key:k.id,item:k,"force-expanded":e(d),class:"bg-base-lvl-3 shadow-md"},{content:m(({isExpanded:P,isAdding:ee,toggleAdding:xe})=>[r("div",wa,[ee?(v(),x("div",xa,[c(J,{placeholder:"Add subcategory",modelValue:b.categoryForm.name,"onUpdate:modelValue":D[4]||(D[4]=U=>b.categoryForm.name=U),onKeydown:Ae(Se(U=>_(k.id,xe),["ctrl"]),["enter"])},null,8,["modelValue","onKeydown"])])):O("",!0),P?(v(),E(e(ge),{key:1,class:"py-2 space-y-2",list:k.subCategories,handle:".handle",onEnd:U=>V(k.subCategories)},{default:m(()=>[(v(!0),x(Z,null,Q(k.subCategories,U=>(v(),E(aa,{class:"bg-base-lvl-2 border-base-lvl-3",key:`${U.id}-${U.budgeted}`,item:U,onEdit:$a=>g.value=U},null,8,["item","onEdit"]))),128))]),_:2},1032,["list","onEnd"])):O("",!0)])]),_:2},1032,["item","force-expanded"]))),128))]),_:1},8,["list"])])]),_:1},8,["accounts","panel-size"])]),_:1}))}};export{Ha as default};
