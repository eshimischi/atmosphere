import{u as Z,q as _,r as q,o as r,g as f,b as s,d as o,k as G,i as b,t as J,m as x,a as u,f as t,e as C,c as k,F as V,h as O,G as L}from"./app.d8e74fa3.js";import{i as y,Z as g,g as N}from"./atmosphere-ui.87ba2c0a.js";import{_ as z}from"./Modal.36144344.js";import{a5 as h}from"./naiveui.0ad5ca37.js";const H={class:"bg-base-lvl-3"},I={class:"px-5 pt-5 pb-4"},K={class:"text-lg font-bold text-primary"},Q={class:"px-5 py-3"},X=["onSubmit"],Y={class:"flex"},ee=b("Manual"),te=b("Recipes"),ae={key:2},le={key:0,class:"ml-5"},ne=o("template",{name:"suffix"},[o("div",null,[o("button",null,"Value"),o("button",null,"Formula"),o("button",null,"Field")])],-1),se=b(" Add component "),oe={class:"px-6 py-4 space-x-3 text-right bg-gray-100"},ie=b(" Cancel "),re=b(" Save "),me={__name:"AutomationModal",props:{show:{type:Boolean,default:!1},maxWidth:{type:String,default:"lg"},closeable:{type:Boolean,default:!0},title:{type:String,default:"Modal"},services:{type:Array,default(){return[]}},integrations:{type:Array,default(){return[]}},recipes:{type:Array,default(){return[]}},tasks:{type:Array,default(){return[]}}},emits:["save"],setup(m,{emit:$}){const v=m,n=Z({service:null,recipe:null,integration:null,tasks:[]}),A=(e,a)=>{n.service=v.services.find(l=>l.id==a.value)},B=_(()=>{var e;return((e=n.service)==null?void 0:e.type)=="external"}),S=q("manual"),w=e=>{S.value=e,e=="manual"&&n.tasks.length==0&&U()},F=e=>e.map(a=>({label:a,value:a})),U=()=>{n.tasks.push({automation_task_id:null,name:"",label:"",config:{},values:{}})},M=(e,a)=>{L(()=>{var d;const l=n.tasks[e],c=v.tasks.find(p=>p.id===a),i=(d=JSON.parse((c==null?void 0:c.config)||"{}"))!=null?d:{};n.tasks[e]={...l,automation_task_id:a,name:c.name,label:c.label,config:i,values:Object.keys(i).reduce((p,W)=>(p[W]="",p),{})}})},j=v.services.map(e=>({label:e.name,value:e.id})),D=_(()=>v.integrations.map(e=>({label:`${e.name} ${e.hash}`,value:e.id}))),E=_(()=>v.recipes.map(e=>({label:e.name,value:e.id}))),P=_(()=>v.tasks.map(e=>({label:e.label,value:e.id})));_(()=>v.recipes.find(e=>e.id===n.recipe));const R=()=>{const e={...n.data()};debugger;return e.name=e.name||e.tasks.map(a=>a.name).join(" "),e.description=e.description||e.tasks.map(a=>a.label).join(" "),e.sentence=e.sentence||e.tasks.map(a=>a.label).join(" "),e.config={},n.integration&&(e.integration_id=e.integration),e},T=()=>{const e=R(),a=e.id?"PUT":"POST",l=e.id?`/${e.id}`:"";axios({url:`/api/automation${l}`,method:a,data:e}).then(()=>{$("saved")})};return(e,a)=>(r(),f(z,{show:m.show,"max-width":m.maxWidth,closeable:m.closeable,onClose:e.close},{default:s(()=>[o("div",H,[o("div",I,[o("h3",K,[G(e.$slots,"title",{},()=>[b(J(m.title),1)])])]),o("div",Q,[o("form",{onSubmit:x(T,["prevent"])},[u(t(y),{label:"Services"},{default:s(()=>[u(t(h),{filterable:"",clearable:"","default-expand-all":!0,options:t(j),"onUpdate:value":A},null,8,["options"])]),_:1}),t(B)?(r(),f(t(y),{key:0,label:"Integration"},{default:s(()=>[u(t(h),{filterable:"",clearable:"",options:t(D),value:t(n).integration,"onUpdate:value":a[0]||(a[0]=l=>t(n).integration=l)},null,8,["options","value"])]),_:1})):C("",!0),o("div",Y,[u(t(g),{onClick:a[1]||(a[1]=x(l=>w("manual"),["prevent"]))},{default:s(()=>[ee]),_:1}),u(t(g),{onClick:a[2]||(a[2]=x(l=>w("recipe"),["prevent"]))},{default:s(()=>[te]),_:1})]),S.value=="recipe"?(r(),f(t(y),{key:1,label:"Recipe"},{default:s(()=>[u(t(h),{filterable:"",clearable:"",options:t(E),value:t(n).recipe,"onUpdate:value":a[3]||(a[3]=l=>t(n).recipe=l)},null,8,["options","value"])]),_:1})):C("",!0),S.value=="manual"||t(n).recipe?(r(),k("div",ae,[(r(!0),k(V,null,O(t(n).tasks,(l,c)=>(r(),k("div",{key:l},[u(t(y),{label:"Automation Task"},{default:s(()=>[u(t(h),{filterable:"",clearable:"",options:t(P),value:m.tasks[c].automation_task_id,"onUpdate:value":[i=>m.tasks[c].automation_task_id=i,i=>M(c,i)]},null,8,["options","value","onUpdate:value"])]),_:2},1024),l.config?(r(),k("div",le,[(r(!0),k(V,null,O(l.config,(i,d)=>(r(),f(t(y),{label:i.label||i.title||d,key:d},{default:s(()=>[i.type=="select"?(r(),f(t(h),{key:0,filterable:"",clearable:"",options:F(i.options),value:l.values[d],"onUpdate:value":p=>l.values[d]=p},null,8,["options","value","onUpdate:value"])):(r(),f(t(N),{key:1,type:"text",modelValue:l.values[d],"onUpdate:modelValue":p=>l.values[d]=p,modelModifiers:{trim:!0}},{default:s(()=>[ne]),_:2},1032,["modelValue","onUpdate:modelValue"]))]),_:2},1032,["label"]))),128))])):C("",!0)]))),128)),u(t(g),{onClick:x(U,["prevent"])},{default:s(()=>[se]),_:1},8,["onClick"])])):C("",!0)],40,X)])]),o("div",oe,[u(t(g),{type:"secondary",onClick:e.close},{default:s(()=>[ie]),_:1},8,["onClick"]),u(t(g),{class:"text-white bg-primary",onClick:T},{default:s(()=>[re]),_:1})])]),_:3},8,["show","max-width","closeable","onClose"]))}};export{me as _};
