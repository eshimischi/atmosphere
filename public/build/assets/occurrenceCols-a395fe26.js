import{X as V,B as L,Z as T}from"./atmosphere-ui-5b718e83.js";import{f as $,m as F,r as z,o as d,e as _,a as i,w as v,b as m,t as S,c as x,i as w,g as b,u as s,O as E,x as D,F as H,h as Y,T as q,J as G,p as M,E as P,L as W}from"./app-fc313f38.js";import{_ as X}from"./Modal-ca404241.js";import{t as Z,_ as J}from"./TransactionsTable-d91fffe7.js";import{r as K,h as U,e as j,f as Q}from"./isMobile-3d69cdae.js";import{_ as B}from"./LogerButton-370ed8f9.js";import{_ as A,p as N}from"./formatMoney-da670e0a.js";import{_ as I}from"./LogerInput-2f23c230.js";import{_ as R}from"./SectionNav-7e8b141c.js";import{d as ee}from"./index-b8f57e29.js";function O(t,o){var l=t.getFullYear()-o.getFullYear()||t.getMonth()-o.getMonth()||t.getDate()-o.getDate()||t.getHours()-o.getHours()||t.getMinutes()-o.getMinutes()||t.getSeconds()-o.getSeconds()||t.getMilliseconds()-o.getMilliseconds();return l<0?-1:l>0?1:l}function te(t,o){K(2,arguments);var l=U(t),e=U(o),u=O(l,e),n=Math.abs(ee(l,e));l.setDate(l.getDate()-u*n);var p=+(O(l,e)===-u),y=u*(n-p);return y===0?0:y}const ae={class:"overflow-auto h-96 ic-scroller"},le={__name:"OccurrencePreview",props:{occurrenceId:{type:Number},conditions:{type:Array}},setup(t){const o=t,l=$([]),e=$(!1);F(async()=>{if(o.occurrenceId&&!e.value){const n=await fetch(`/housing/occurrence/${o.occurrenceId}/preview`);l.value=await n.json(),e.value=!0}});const u=()=>{axios.post(`/housing/occurrence/${o.occurrenceId}/load`).then(()=>{E.reload()})};return(n,p)=>{const y=z("Header");return d(),_("article",null,[i(y,{class:"flex justify-between py-1"},{default:v(()=>[m("span",null," Transactions ("+S(l.value.length)+") ",1),l.value.length?(d(),x(B,{key:0,variant:"inverse",onClick:u},{default:v(()=>[w(" Load ")]),_:1})):b("",!0)]),_:1}),m("section",ae,[i(J,{class:"w-full","table-class":"overflow-auto text-sm",transactions:l.value,parser:s(Z)},null,8,["transactions","parser"])])])}}},se={class:"rounded-md py-2"},oe={class:"flex justify-between"},ne={key:0,class:"px-4 mt-4 space-y-2"},re={__name:"ConditionDescription",props:{label:{type:String},modelValue:{type:Array,required:!0}},emits:["update:modelValue"],setup(t,{emit:o}){const l=t,e=[{value:"contains",label:"Contains"},{value:"is",label:"Is"}],u=D({isActive:g(l.modelValue)}),n=D({conditions:l.modelValue}),p=()=>{o("update:modelValue",[...n.conditions])},y=()=>{n.conditions.push({operator:"",value:""})},C=f=>{n.conditions.splice(f)},k=f=>f!=0&&f==n.conditions.length-1;function g(f){return f.some(c=>c.value)}return(f,c)=>(d(),_("article",se,[m("header",oe,[i(s(V),{modelValue:u.isActive,"onUpdate:modelValue":c[0]||(c[0]=a=>u.isActive=a),label:t.label,class:"w-full rounded-md py-4 inline-block"},null,8,["modelValue","label"])]),u.isActive?(d(),_("section",ne,[(d(!0),_(H,null,Y(n.conditions,(a,h)=>(d(),_("div",{class:"flex space-x-4",key:`option-${h}`},[i(s(j),{filterable:"",clearable:"",value:a.operator,"onUpdate:value":r=>a.operator=r,"default-expand-all":!0,options:e,size:"large"},null,8,["value","onUpdate:value"]),i(I,{modelValue:a.value,"onUpdate:modelValue":r=>a.value=r,onBlur:p},null,8,["modelValue","onUpdate:modelValue"]),k(h)?(d(),x(A,{key:0,class:"rounded-md",onClick:r=>C(h)},{default:v(()=>[w(" - ")]),_:2},1032,["onClick"])):b("",!0),i(A,{class:"rounded-md",onClick:y},{default:v(()=>[w(" + ")]),_:1})]))),128))])):b("",!0)]))}},ie={class:"rounded-md py-2"},ce={class:"flex justify-between"},ue={key:0,class:"px-4 mt-4 space-y-2"},de={__name:"ConditionSelect",props:{label:{type:String},options:{type:Array,default(){return[]}},multiple:{type:Boolean,default:!1},modelValue:{type:[Object,Array,String,null],default:null}},setup(t){var e;const l=D({isActive:!!((e=t.modelValue)!=null&&e.length)});return(u,n)=>(d(),_("article",ie,[m("header",ce,[i(s(V),{modelValue:l.isActive,"onUpdate:modelValue":n[0]||(n[0]=p=>l.isActive=p),label:t.label,class:"w-full rounded-md py-4 inline-block"},null,8,["modelValue","label"])]),l.isActive?(d(),_("section",ue,[i(s(j),{filterable:"",clearable:"",size:"large",multiple:t.multiple,value:t.modelValue,"onUpdate:value":n[1]||(n[1]=p=>u.$emit("update:modelValue",p)),"default-expand-all":!0,options:t.options},null,8,["multiple","value","options"])])):b("",!0)]))}},me={class:"flex items-center px-6 py-2 font-bold bg-base-lvl-3"},pe=m("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","aria-hidden":"true",role:"img",class:"iconify iconify--ic",width:"32",height:"32",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 24 24"},[m("path",{fill:"currentColor",d:"M14.71 6.71a.996.996 0 0 0-1.41 0L8.71 11.3a.996.996 0 0 0 0 1.41l4.59 4.59a.996.996 0 1 0 1.41-1.41L10.83 12l3.88-3.88c.39-.39.38-1.03 0-1.41z"})],-1),fe=m("span",{class:"py-4"}," Create Occurrence Check ",-1),ve={class:"pt-0 pb-4 bg-base-lvl-3 sm:pt-0 sm:pb-4 text-body"},_e={class:"content sm:px-6"},ye={key:0},be={class:"flex-col space-y-2"},ge={key:1,class:"pt-4 space-y-4"},he={class:"px-6 py-4 space-x-3 text-right bg-base flex justify-end"},Ne={__name:"OccurrenceCheckModal",props:{show:{default:!1},maxWidth:{default:"2xl"},closeable:{default:!0},formData:{type:Object,default:()=>({})}},emits:["update:show"],setup(t,{emit:o}){const l=t,e=q({id:null,name:"",type:"transactions",conditions:{description:[{operator:"",value:""}],category_id:null,payee_id:"",labels:"",account_id:""},notify_on_avg:!0,notify_on_last_count:!0,is_active:!0,log:[]});G(()=>l.formData,c=>{Object.keys(e.data()).forEach(a=>{a=="date"?e[a]=new Date(c[a]):c&&c[a]&&(e[a]=c[a])})},{deep:!0,immediate:!0});const u=()=>{o("update:show",!1)},n=M(()=>l.formData&&l.formData.id),p=M(()=>n.value?"Update":"Create"),y=()=>{const c=l.formData.id?"put":"post";n.value?C():e.submit(c,route("occurrence.store"),{onSuccess(){u(),o("saved",e.data()),e.reset()}})},C=()=>{const c=`/housing/occurrence/${l.formData.id}`;e.put(c,{onSuccess(){u(),o("saved",e.data()),e.reset()}})},k=P("categoryOptions",[]),g=$("information"),f=[{label:"Information",value:"information"},{label:"Rule",value:"rule"},{label:"Preview",value:"preview"}];return(c,a)=>(d(),x(X,{show:t.show,"max-width":t.maxWidth,closeable:t.closeable,onClose:u},{default:v(({close:h})=>[m("header",me,[c.selectedResource?(d(),x(A,{key:0,onClick:a[0]||(a[0]=r=>c.selectedResource="")},{default:v(()=>[pe]),_:1})):b("",!0),fe]),m("article",ve,[i(R,{modelValue:g.value,"onUpdate:modelValue":a[1]||(a[1]=r=>g.value=r),sections:f,class:"px-4"},null,8,["modelValue"]),m("section",_e,[g.value=="information"?(d(),_("section",ye,[i(s(L),{label:"Name"},{default:v(()=>[i(I,{modelValue:s(e).name,"onUpdate:modelValue":a[2]||(a[2]=r=>s(e).name=r)},null,8,["modelValue"])]),_:1}),m("div",be,[i(s(V),{modelValue:s(e).notify_on_avg,"onUpdate:modelValue":a[3]||(a[3]=r=>s(e).notify_on_avg=r),label:"Notify on AVG"},null,8,["modelValue"]),i(s(V),{modelValue:s(e).notify_on_last_count,"onUpdate:modelValue":a[4]||(a[4]=r=>s(e).notify_on_last_count=r),label:"Notify on last count"},null,8,["modelValue"]),i(s(V),{modelValue:s(e).is_active,"onUpdate:modelValue":a[5]||(a[5]=r=>s(e).is_active=r),label:"Active"},null,8,["modelValue"])])])):b("",!0),g.value=="rule"?(d(),_("section",ge,[i(re,{label:"Description",modelValue:s(e).conditions.description,"onUpdate:modelValue":a[6]||(a[6]=r=>s(e).conditions.description=r)},null,8,["modelValue"]),i(de,{label:"Categories",modelValue:s(e).conditions.category_id,"onUpdate:modelValue":a[7]||(a[7]=r=>s(e).conditions.category_id=r),options:s(k),multiple:""},null,8,["modelValue","options"])])):b("",!0),g.value=="preview"?(d(),x(le,{key:2,"occurrence-id":s(e).id,conditions:s(e).conditions},null,8,["occurrence-id","conditions"])):b("",!0)])]),m("footer",he,[i(s(T),{type:"secondary",onClick:h,rounded:"",class:"h-10"},{default:v(()=>[w(" Cancel ")]),_:2},1032,["onClick"]),i(B,{variant:"inverse",onClick:y,disabled:!s(e).name},{default:v(()=>[w(S(p.value),1)]),_:1},8,["disabled"])])]),_:1},8,["show","max-width","closeable"]))}},Oe=[{label:"Name",name:"name",width:400,class:"w-full capitalize"},{label:"Last Occurrence",name:"last_date",render(t){const o=t.last_date&&N(t.last_date);return W("div",{class:"text-info cursor-pointer"},o&&Q(o,"dd MMM, yyyy"))}},{label:"Duration",name:"current_days_count",width:300,render(t){if(t.last_date){const o=t.last_date&&N(t.last_date);return te(new Date,o)}return 0}},{label:"Last Duration",name:"previous_days_count",width:300,class:"text-center",headerClass:"text-center"},{label:"AVG Days",name:"avg_days_passed",type:"custom",class:"text-right",headerClass:"text-right"},{label:"Status",name:"status",width:200,class:"py-1 flex items-center justify-center",headerClass:"text-center"},{label:"",name:"actions",width:300,type:"custom",class:"text-right"}];export{Ne as _,Oe as o};
