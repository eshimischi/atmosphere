import{s as k,q as C,o as r,g as O,b as c,a as p,d as e,c as d,h as u,t as o,f as b,F as m,i as M,H as S,a6 as g}from"./app.cefd7668.js";import{_ as E}from"./AppLayout.cd77f56f.js";import{_ as L}from"./AutomationModal.b406fc32.js";import{_ as $}from"./SettingsSectionNav.9ed9b9bc.js";import{_ as B}from"./LogerButton.0789417e.js";import"./atmosphere-ui.588c294c.js";import"./_plugin-vue_export-helper.cdc0426e.js";import"./index.de789d8e.js";import"./Modal.a2277346.js";/* empty css                                              */import"./LogerInput.bec0734e.js";import"./SectionNav.d2e4d6cd.js";const N=M(" Add Automation "),G={class:"py-12 pt-32 h-auto mx-auto space-y-4 max-w-7xl sm:px-6 lg:px-8"},P=["onClick"],T=["src"],D={class:"ml-5"},V={class:"ml-2"},F={class:"w-full integrations-form"},K={class:"left"},R={class:"head"},X={class:"tagline"},q={class:"text-right automations"},H=e("div",{class:"text-right options"},"options",-1),ot={__name:"Integrations",props:{services:{type:Array,default(){return[]}},integrations:{type:Array,default(){return[]}},recipes:{type:Array,default(){return[]}},tasks:{type:Array,default(){return[]}}},setup(n){const _=n,i=k({showAddConnection:!1,authInstance:null,isAutomationModalOpen:!1,openedAutomation:{}}),h=(s,a)=>{i.isAutomationModalOpen=!0,i.openedAutomation={board:s,stage:a}},f=()=>{S(()=>{i.isAutomationModalOpen=!1,g.Inertia.reload("/integrations",{only:["integrations"],preserveState:!0})})},y=s=>{switch(s.name.toLowerCase()){case"google":case"gmail":w(s.name.toLowerCase(),s);break}},v=C(()=>_.services.filter(s=>s.type=="external")),w=(s,a)=>{gapi.load("auth2",()=>{gapi.auth2.init({apiKey:process.env.MIX_GOOGLE_APP_KEY,clientId:process.env.MIX_GOOGLE_CLIENT_ID,accessType:"offline",scope:"profile https://www.googleapis.com/auth/gmail.readonly https://www.googleapis.com/auth/calendar.readonly",discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest","https://sheets.googleapis.com/discovery/rest?version=v4"]}).then(async()=>{const t=gapi.auth2.getAuthInstance(),l=t.currentUser.get();l.getAuthResponse().session_state||await t.signIn();const x=l.getBasicProfile();await t.grantOfflineAccess({authuser:l.getAuthResponse().session_state.extraQueryParams.authuser}).then(({code:A})=>{const I={code:A,service_id:a.id,service_name:a.name,user:x.getEmail()};axios.post("/services/google",{credentials:I}).then(()=>{g.Inertia.get("/integrations",{only:["integrations"],preserveState:!0})})})})})};return(s,a)=>(r(),O(E,{title:"Settings - Integrations"},{header:c(()=>[p($,null,{actions:c(()=>[p(B,{variant:"inverse",class:"text-white bg-primary",onClick:h},{default:c(()=>[N]),_:1})]),_:1})]),default:c(()=>[e("div",G,[(r(!0),d(m,null,u(b(v),t=>(r(),d("div",{key:t.id,onClick:l=>y(t),class:"flex px-5 py-3 bg-base-lvl-3 rounded-md shadow-xl cursor-pointer"},[e("div",null,[e("img",{src:t.logo,class:"w-9"},null,8,T)]),e("h2",D,o(t.name),1),e("p",V,o(t.description),1)],8,P))),128)),e("div",F,[(r(!0),d(m,null,u(n.integrations,t=>(r(),d("div",{class:"grid grid-cols-3 px-5 py-3 my-2 font-bold text-gray-500 bg-base-lvl-1 cursor-pointer app-service__item",key:t.id},[e("div",K,[e("div",R,o(t.name)+" "+o(t.hash),1),e("div",X,o(t.hash)+" "+o(t.created_at),1)]),e("div",q,o(t.automations.length),1),H]))),128))]),p(L,{show:i.isAutomationModalOpen,"record-data":s.openedAutomation,closeable:!0,title:"Add a new automation",services:n.services,integrations:n.integrations,recipes:n.recipes,tasks:n.tasks,type:"event",onCancel:a[0]||(a[0]=t=>i.isAutomationModalOpen=!1),onSaved:f},null,8,["show","record-data","services","integrations","recipes","tasks"])])]),_:1}))}};export{ot as default};
