import{T as R,q as k,r as W,o as u,c as v,w as s,b as o,s as Z,i as f,t as J,k as x,a as c,u as a,g as C,f as y,F as V,h as B,M as L}from"./app-114b751b.js";import{B as g,Z as _,q as N}from"./atmosphere-ui-b819c890.js";import{_ as z}from"./Modal-c2871cdd.js";import{e as h}from"./isMobile-e3872359.js";const G={class:"bg-base-lvl-3"},H={class:"px-5 pt-5 pb-4"},I={class:"text-lg font-bold text-primary"},K={class:"px-5 py-3"},Q=["onSubmit"],X={class:"flex"},Y={key:2},ee={key:0,class:"ml-5"},te=o("template",{name:"suffix"},[o("div",null,[o("button",null,"Value"),o("button",null,"Formula"),o("button",null,"Field")])],-1),ae={class:"px-6 py-4 space-x-3 text-right bg-gray-100"},re={__name:"AutomationModal",props:{show:{type:Boolean,default:!1},maxWidth:{type:String,default:"lg"},closeable:{type:Boolean,default:!0},title:{type:String,default:"Modal"},services:{type:Array,default(){return[]}},integrations:{type:Array,default(){return[]}},recipes:{type:Array,default(){return[]}},tasks:{type:Array,default(){return[]}}},emits:["save"],setup(p,{emit:O}){const m=p,n=R({service:null,recipe:null,integration:null,tasks:[]}),$=(e,t)=>{n.service=m.services.find(l=>l.id==t.value)},A=k(()=>{var e;return((e=n.service)==null?void 0:e.type)=="external"}),S=W("manual"),w=e=>{S.value=e,e=="manual"&&n.tasks.length==0&&T()},M=e=>e.map(t=>({label:t,value:t})),T=()=>{n.tasks.push({automation_task_id:null,name:"",label:"",config:{},values:{}})},F=(e,t)=>{L(()=>{const l=n.tasks[e],d=m.tasks.find(i=>i.id===t),r=JSON.parse((d==null?void 0:d.config)||"{}")??{};n.tasks[e]={...l,automation_task_id:t,name:d.name,label:d.label,config:r,values:Object.keys(r).reduce((i,b)=>(i[b]="",i),{})}})},j=m.services.map(e=>({label:e.name,value:e.id})),q=k(()=>m.integrations.map(e=>({label:`${e.name} ${e.hash}`,value:e.id}))),D=k(()=>m.recipes.map(e=>({label:e.name,value:e.id}))),E=k(()=>m.tasks.map(e=>({label:e.label,value:e.id})));k(()=>m.recipes.find(e=>e.id===n.recipe));const P=()=>{const e={...n.data()};debugger;return e.name=e.name||e.tasks.map(t=>t.name).join(" "),e.description=e.description||e.tasks.map(t=>t.label).join(" "),e.sentence=e.sentence||e.tasks.map(t=>t.label).join(" "),e.config={},n.integration&&(e.integration_id=e.integration),e},U=()=>{const e=P(),t=e.id?"PUT":"POST",l=e.id?`/${e.id}`:"";axios({url:`/api/automation${l}`,method:t,data:e}).then(()=>{O("saved")})};return(e,t)=>(u(),v(z,{show:p.show,"max-width":p.maxWidth,closeable:p.closeable,onClose:e.close},{default:s(()=>[o("div",G,[o("div",H,[o("h3",I,[Z(e.$slots,"title",{},()=>[f(J(p.title),1)])])]),o("div",K,[o("form",{onSubmit:x(U,["prevent"])},[c(a(g),{label:"Services"},{default:s(()=>[c(a(h),{filterable:"",clearable:"","default-expand-all":!0,options:a(j),"onUpdate:value":$},null,8,["options"])]),_:1}),A.value?(u(),v(a(g),{key:0,label:"Integration"},{default:s(()=>[c(a(h),{filterable:"",clearable:"",options:q.value,value:a(n).integration,"onUpdate:value":t[0]||(t[0]=l=>a(n).integration=l)},null,8,["options","value"])]),_:1})):C("",!0),o("div",X,[c(a(_),{onClick:t[1]||(t[1]=x(l=>w("manual"),["prevent"]))},{default:s(()=>[f("Manual")]),_:1}),c(a(_),{onClick:t[2]||(t[2]=x(l=>w("recipe"),["prevent"]))},{default:s(()=>[f("Recipes")]),_:1})]),S.value=="recipe"?(u(),v(a(g),{key:1,label:"Recipe"},{default:s(()=>[c(a(h),{filterable:"",clearable:"",options:D.value,value:a(n).recipe,"onUpdate:value":t[3]||(t[3]=l=>a(n).recipe=l)},null,8,["options","value"])]),_:1})):C("",!0),S.value=="manual"||a(n).recipe?(u(),y("div",Y,[(u(!0),y(V,null,B(a(n).tasks,(l,d)=>(u(),y("div",{key:l},[c(a(g),{label:"Automation Task"},{default:s(()=>[c(a(h),{filterable:"",clearable:"",options:E.value,value:p.tasks[d].automation_task_id,"onUpdate:value":[r=>p.tasks[d].automation_task_id=r,r=>F(d,r)]},null,8,["options","value","onUpdate:value"])]),_:2},1024),l.config?(u(),y("div",ee,[(u(!0),y(V,null,B(l.config,(r,i)=>(u(),v(a(g),{label:r.label||r.title||i,key:i},{default:s(()=>[r.type=="select"?(u(),v(a(h),{key:0,filterable:"",clearable:"",options:M(r.options),value:l.values[i],"onUpdate:value":b=>l.values[i]=b},null,8,["options","value","onUpdate:value"])):(u(),v(a(N),{key:1,type:"text",modelValue:l.values[i],"onUpdate:modelValue":b=>l.values[i]=b,modelModifiers:{trim:!0}},{default:s(()=>[te]),_:2},1032,["modelValue","onUpdate:modelValue"]))]),_:2},1032,["label"]))),128))])):C("",!0)]))),128)),c(a(_),{onClick:x(T,["prevent"])},{default:s(()=>[f(" Add component ")]),_:1},8,["onClick"])])):C("",!0)],40,Q)])]),o("div",ae,[c(a(_),{type:"secondary",onClick:e.close},{default:s(()=>[f(" Cancel ")]),_:1},8,["onClick"]),c(a(_),{class:"text-white bg-primary",onClick:U},{default:s(()=>[f(" Save ")]),_:1})])]),_:3},8,["show","max-width","closeable","onClose"]))}};export{re as _};
